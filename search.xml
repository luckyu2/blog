<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>用Vue框架开发移动端XX购商城项目开发思路</title>
      <link href="2021/01/13/%E7%A7%BB%E5%8A%A8%E7%AB%AFXX%E8%B4%AD%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%80%9D%E8%B7%AF/"/>
      <url>2021/01/13/%E7%A7%BB%E5%8A%A8%E7%AB%AFXX%E8%B4%AD%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<h3 id="一-gridView"><a href="#一-gridView" class="headerlink" title="一. gridView"></a>一. gridView</h3><ul><li>独立组件封装gridView 用于goodslistitem，每件商品橱窗页面的展示<ul><li>div&gt;a&gt;img</li></ul></li></ul><h3 id="二-TabControl"><a href="#二-TabControl" class="headerlink" title="二. TabControl"></a>二. TabControl</h3><ul><li>独立组件的封装<ul><li>props -&gt; titles</li><li>div&gt;根据titles v-for遍历 div -&gt; span用Vue框架开发移动端XX购商城项目开发思路</li><li>css相关</li><li>选中哪一个tab, 哪一个tab的文字颜色变色, 下面border-bottom<ul><li>currentIndex</li></ul></li></ul></li></ul><h3 id="三-首页商品数据的请求"><a href="#三-首页商品数据的请求" class="headerlink" title="三. 首页商品数据的请求"></a>三. 首页商品数据的请求</h3><h4 id="3-1-设计数据结构-用于保存数据"><a href="#3-1-设计数据结构-用于保存数据" class="headerlink" title="3.1. 设计数据结构, 用于保存数据"></a>3.1. 设计数据结构, 用于保存数据</h4><p>goods: {</p><p>pop: page/list</p><p>new: page/list</p><p>sell: page/list</p><p>}</p><h4 id="3-2-发送数据请求"><a href="#3-2-发送数据请求" class="headerlink" title="3.2. 发送数据请求"></a>3.2. 发送数据请求</h4><ul><li>在home.js中封装getHomeGoods(type, page)</li><li>在Home.vue中, 又在methods中getHomeGoods(type)</li><li>调用getHomeGoods(‘pop’)/getHomeGoods(‘new’)/getHomeGoods(‘sell’)<ul><li>page: 动态的获取对应的page</li></ul></li><li>获取到数据: res<ul><li>this.goods[type].list.push(…res.data.list)</li><li>this.goods[type].page += 1</li></ul></li></ul><p>goods: {</p><p>pop: page1:/list[30]</p><p>new: page1/list[30]</p><p>sell: page1/list[30]</p><p>}</p><h3 id="四-对商品数据进行展示"><a href="#四-对商品数据进行展示" class="headerlink" title="四. 对商品数据进行展示"></a>四. 对商品数据进行展示</h3><h4 id="4-1-封装GoodsList-vue组件"><a href="#4-1-封装GoodsList-vue组件" class="headerlink" title="4.1. 封装GoodsList.vue组件"></a>4.1. 封装GoodsList.vue组件</h4><ul><li>props: goods -&gt; list[30]</li><li>v-for goods -&gt; GoodsListItem[30]</li><li>GoodListItem(组件) -&gt; GoodsItem(数据)</li></ul><h4 id="4-2-封装GoodsListItem-vue组件"><a href="#4-2-封装GoodsListItem-vue组件" class="headerlink" title="4.2. 封装GoodsListItem.vue组件"></a>4.2. 封装GoodsListItem.vue组件</h4><ul><li>props: goodsItem</li><li>goodsItem 取出数据, 并且使用正确的div/span/img基本标签进行展示</li></ul><h3 id="五-对滚动进行重构-Better-Scroll"><a href="#五-对滚动进行重构-Better-Scroll" class="headerlink" title="五. 对滚动进行重构: Better-Scroll"></a>五. 对滚动进行重构: Better-Scroll</h3><h4 id="5-1-在index-html中使用Better-Scroll"><a href="#5-1-在index-html中使用Better-Scroll" class="headerlink" title="5.1. 在index.html中使用Better-Scroll"></a>5.1. 在index.html中使用Better-Scroll</h4><ul><li>const bscroll = new BScroll(el, { })</li><li>注意: wrapper -&gt; content -&gt; 很多内容</li><li>1.监听滚动<ul><li>probeType: 0/1/2(手指滚动)/3(只要是滚动)</li><li>bscroll .on(‘scroll’, (position) =&gt; {})</li></ul></li><li>2.上拉加载<ul><li>pullUpLoad: true</li><li>bscroll .on(‘pullingUp’, () =&gt; {})</li></ul></li><li>3.click: false<ul><li>button可以监听点击</li><li>div不可以</li></ul></li></ul><h4 id="5-2-在Vue项目中使用Better-Scroll"><a href="#5-2-在Vue项目中使用Better-Scroll" class="headerlink" title="5.2. 在Vue项目中使用Better-Scroll"></a>5.2. 在Vue项目中使用Better-Scroll</h4><ul><li>在Profile.vue中简单的演示</li><li>对Better-Scroll进行封装: Scroll.vue</li><li>Home.vue和Scroll.vue之间进行通信<ul><li>Home.vue将probeType设置为3</li><li>Scroll.vue需要通过$emit, 实时将事件发送到Home.vue</li></ul></li></ul><h3 id="六-回到顶部BackTop"><a href="#六-回到顶部BackTop" class="headerlink" title="六. 回到顶部BackTop"></a>六. 回到顶部BackTop</h3><h4 id="6-1-对BackTop-vue组件的封装"><a href="#6-1-对BackTop-vue组件的封装" class="headerlink" title="6.1. 对BackTop.vue组件的封装"></a>6.1. 对BackTop.vue组件的封装</h4><h4 id="6-2-如何监听组件的点击"><a href="#6-2-如何监听组件的点击" class="headerlink" title="6.2. 如何监听组件的点击"></a>6.2. 如何监听组件的点击</h4><ul><li>直接监听back-top的点击, 但是可以直接监听?<ul><li>不可以, 必须添加修饰.native</li></ul></li><li>回到顶部<ul><li>scroll对象, scroll.scrollTo(x, y, time)</li><li>this.$refs.scroll.scrollTo(0, 0, 500)</li></ul></li></ul><h4 id="6-3-BackTop组件的显示和隐藏"><a href="#6-3-BackTop组件的显示和隐藏" class="headerlink" title="6.3. BackTop组件的显示和隐藏"></a>6.3. BackTop组件的显示和隐藏</h4><ul><li>isShowBackTop: false</li><li>监听滚动, 拿到滚动的位置:<ul><li>-position.y &gt; 1000 -&gt; isShowBackTop: true</li><li>isShowBackTop = -position.y &gt; 1000</li></ul></li></ul><h3 id="七-解决首页中可滚动区域的问题"><a href="#七-解决首页中可滚动区域的问题" class="headerlink" title="七. 解决首页中可滚动区域的问题"></a>七. 解决首页中可滚动区域的问题</h3><ul><li><p>Better-Scroll在决定有多少区域可以滚动时, 是根据scrollerHeight属性决定</p><ul><li>scrollerHeight属性是根据放Better-Scroll的content中的子组件的高度</li><li>但是我们的首页中, 刚开始在计算scrollerHeight属性时, 是没有将图片计算在内的</li><li>所以, 计算出来的告诉是错误的(1300+)</li><li>后来图片加载进来之后有了新的高度, 但是scrollerHeight属性并没有进行更新.</li><li>所以滚动出现了问题</li></ul></li><li><p>如何解决这个问题了?</p><ul><li>监听每一张图片是否加载完成, 只要有一张图片加载完成了, 执行一次refresh()</li><li>如何监听图片加载完成了?<ul><li>原生的js监听图片: img.onload = function() {}</li><li>Vue中监听: @load=’方法’</li></ul></li><li>调用scroll的refresh()</li></ul></li><li><p>如何将GoodsListItem.vue中的事件传入到Home.vue中</p><ul><li><p>因为涉及到非父子组件的通信, 所以这里我们选择了</p><p>事件总线</p><ul><li>bus -&gt;总线</li><li>Vue.prototype.$bus = new Vue()</li><li>this.bus.emit(‘事件名称’, 参数)</li><li>this.bus.on(‘事件名称’, 回调函数(参数))</li></ul></li></ul></li><li><p>问题一: refresh找不到的问题</p><ul><li>第一: 在Scroll.vue中, 调用this.scroll的方法之前, 判断this.scroll对象是否有值</li><li>第二: 在mounted生命周期函数中使用 this.$refs.scroll而不是created中</li></ul></li><li><p>问题二: 对于refresh非常频繁的问题, 进行防抖操作</p><ul><li>防抖debounce/节流throttle(课下研究一下)</li><li>防抖函数起作用的过程:<ul><li>如果我们直接执行refresh, 那么refresh函数会被执行30次.</li><li>可以将refresh函数传入到debounce函数中, 生成一个新的函数.</li><li>之后在调用非常频繁的时候, 就使用新生成的函数.</li><li>而新生成的函数, 并不会非常频繁的调用, 如果下一次执行来的非常快, 那么会将上一次取消掉</li></ul></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">debounce(func, delay) &#123;</span><br><span class="line">  let timer &#x3D; null</span><br><span class="line">  return function (...args) &#123;</span><br><span class="line">    if (timer) clearTimeout(timer)</span><br><span class="line">    timer &#x3D; setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">      func.apply(this, args)</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="八-上拉加载更多的功能"><a href="#八-上拉加载更多的功能" class="headerlink" title="八. 上拉加载更多的功能"></a>八. 上拉加载更多的功能</h3><ul><li>监听是否滚动到底部的办法，利用非父子组件通信的方式，获取调用BScroll库中封装的pullingUp方法，此方法用于判断是否到下拉到底部，用emit将此方法发送到父组件</li><li>当滚动到底部的时，父组件将调用pullingUp方法，当被调用时，pullingUp方法中的this.getHomeGoods(this.currentType)方法被调用</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getHomeGoods(type)&#123;</span><br><span class="line">  let page &#x3D; this.goods[type].page + 1</span><br><span class="line">  getHomeGoods(type,page).then(res&#x3D;&gt;&#123;</span><br><span class="line">    this.goods[type].list.push(...res.data.list)</span><br><span class="line">    this.goods[type].page +&#x3D; 1</span><br><span class="line">    &#x2F;&#x2F;调用重置下拉次数的方法</span><br><span class="line">    this.$refs.scroll.finishPullUp()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="九-tabControl的吸顶效果"><a href="#九-tabControl的吸顶效果" class="headerlink" title="九. tabControl的吸顶效果"></a>九. tabControl的吸顶效果</h3><h4 id="9-1-获取到tabControl的offsetTop"><a href="#9-1-获取到tabControl的offsetTop" class="headerlink" title="9.1. 获取到tabControl的offsetTop"></a>9.1. 获取到tabControl的offsetTop</h4><ul><li>必须知道滚动到多少时, 开始有吸顶效果, 这个时候就需要获取tabControl的offsetTop</li><li>但是, 如果直接在mounted中获取tabControl的offsetTop, 那么值是不正确.</li><li>如何获取正确的值了?<ul><li>监听HomeSwiper中img的加载完成.</li><li>加载完成后, 发出事件, 在Home.vue中, 获取正确的值.</li><li>补充:<ul><li>为了不让HomeSwiper多次发出事件,</li><li>可以使用isLoad的变量进行状态的记录.</li></ul></li><li>注意: 这里不进行多次调用和debounce的区别</li></ul></li></ul><h4 id="9-2-监听滚动-动态的改变tabControl的样式"><a href="#9-2-监听滚动-动态的改变tabControl的样式" class="headerlink" title="9.2. 监听滚动, 动态的改变tabControl的样式"></a>9.2. 监听滚动, 动态的改变tabControl的样式</h4><ul><li>问题:动态的改变tabControl的样式时, 会出现两个问题:<ul><li>问题一: 下面的商品内容, 会突然上移</li><li>问题二: tabControl虽然设置了fixed, 但是也随着Better-Scroll一起滚出去了.</li></ul></li><li>其他方案来解决停留问题.<ul><li>在最上面, 多复制了一份PlaceHolderTabControl组件对象, 利用它来实现停留效果.</li><li>当用户滚动到一定位置时, PlaceHolderTabControl显示出来.</li><li>当用户滚动没有达到一定位置时, PlaceHolderTabControl隐藏起来.</li></ul></li></ul><h3 id="十-让Home保持原来的状态"><a href="#十-让Home保持原来的状态" class="headerlink" title="十. 让Home保持原来的状态"></a>十. 让Home保持原来的状态</h3><h4 id="10-1-让Home不要随意销毁掉"><a href="#10-1-让Home不要随意销毁掉" class="headerlink" title="10.1. 让Home不要随意销毁掉"></a>10.1. 让Home不要随意销毁掉</h4><ul><li>keep-alive</li></ul><h4 id="10-2-让Home中的内容保持原来的位置"><a href="#10-2-让Home中的内容保持原来的位置" class="headerlink" title="10.2. 让Home中的内容保持原来的位置"></a>10.2. 让Home中的内容保持原来的位置</h4><ul><li>离开时, 保存一个位置信息saveY.</li><li>进来时, 将位置设置为原来保存的位置saveY信息即可.<ul><li>注意: 最好回来时, 进行一次refresh()</li></ul></li></ul><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCP三次握手四次挥手详解</title>
      <link href="2021/01/12/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%AF%A6%E8%A7%A3/"/>
      <url>2021/01/12/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="TCP三次握手四次挥手详解"><a href="#TCP三次握手四次挥手详解" class="headerlink" title="TCP三次握手四次挥手详解"></a>TCP三次握手四次挥手详解</h2><p><a href="https://www.cnblogs.com/zmlctt/p/3690998.html">原文章地址</a></p><p>相对于SOCKET开发者,TCP创建过程和链接折除过程是由TCP/IP协议栈自动创建的.因此开发者并不需要控制这个过程.但是对于理解TCP底层运作机制,相当有帮助.</p><p>而且对于有网络协议工程师之类笔试,几乎是必考的内容.企业对这个问题热情之高,出乎我的意料：-）。有时上午面试前强调这个问题，并重复讲一次，下午几乎每一个人都被问到这个问题。</p><p>因此在这里详细解释一下这两个过程。</p><h4 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手"></a><strong>TCP三次握手</strong></h4><p>所谓三次握手(Three-way Handshake)，是指建立一个TCP连接时，需要客户端和服务器总共发送3个包。</p><p>三次握手的目的是连接服务器指定端口，建立TCP连接,并同步连接双方的序列号和确认号并交换 TCP 窗口大小信息.在socket编程中，客户端执行connect()时。将触发三次握手。</p><p>第一次握手:<br>客户端发送一个TCP的SYN标志位置1的包指明客户打算连接的服务器的端口，以及初始序号X,保存在包头的序列号(Sequence Number)字段里。</p><p>第二次握手:<br>服务器发回确认包(ACK)应答。即SYN标志位和ACK标志位均为1同时，将确认序号(Acknowledgement Number)设置为客户的I S N加1以.即X+1。</p><p>第三次握手.<br>客户端再次发送确认包(ACK) SYN标志位为0,ACK标志位为1.并且把服务器发来ACK的序号字段+1,放在确定字段中发送给对方.并且在数据段放写ISN的+1</p><p><strong>SYN攻击</strong><br>在三次握手过程中，服务器发送SYN-ACK之后，收到客户端的ACK之前的TCP连接称为半连接(half-open connect).此时服务器处于Syn_RECV状态.当收到ACK后，服务器转入ESTABLISHED状态.<br>Syn攻击就是 攻击客户端 在短时间内伪造大量不存在的IP地址，向服务器不断地发送syn包，服务器回复确认包，并等待客户的确认，由于源地址是不存在的，服务器需要不断的重发直 至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，目标系统运行缓慢，严重者引起网络堵塞甚至系统瘫痪。<br>Syn攻击是一个典型的<a href="https://www.centos.bz/tag/ddos/">DDOS</a>攻击。检测SYN攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击.在<a href="http://www.centos.bz/">Linux</a>下可以如下命令检测是否被Syn攻击<br>netstat -n -p TCP | grep SYN_RECV<br>一般较新的TCP/IP协议栈都对这一过程进行修正来防范Syn攻击，修改tcp协议实现。主要方法有SynAttackProtect保护机制、SYN cookies技术、增加最大半连接和缩短超时时间等.<br>但是不能完全防范syn攻击。<br><strong>TCP 四次挥手</strong><br>TCP的连接的拆除需要发送四个包，因此称为四次挥手(four-way handshake)。客户端或服务器均可主动发起挥手动作，在socket编程中，任何一方执行close()操作即可产生挥手操作。</p><p>参见wireshark抓包，实测的抓包结果并没有严格按挥手时序。我估计是时间间隔太短造成。<br>注意上面的字段标号地段和发送接收的内容序号，可能有个有错，记不住哪个了，后头要细看看</p><h4 id="第二部分：补充tcp连接过程"><a href="#第二部分：补充tcp连接过程" class="headerlink" title="第二部分：补充tcp连接过程"></a>第二部分：补充tcp连接过程</h4><p>在TCP/IP协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接，如图1所示。</p><p> (1) 第一次握手：建立连接时，客户端A发送SYN包(SYN=j)到服务器B，并进入SYN_SEND状态，等待服务器B确认。</p><p> (2) 第二次握手：服务器B收到SYN包，必须确认客户A的SYN(ACK=j+1)，同时自己也发送一个SYN包(SYN=k)，即SYN+ACK包，此时服务器B进入SYN_RECV状态。</p><p> (3) 第三次握手：客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK(ACK=k+1)，此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。</p><p>完成三次握手，客户端与服务器开始传送数据。</p><p>​               图1 TCP三次握手建立连接</p><p>由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。</p><p>（1）客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送(报文段4)。</p><p>（2）服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1(报文段5)。和SYN一样，一个FIN将占用一个序号。</p><p>（3）服务器B关闭与客户端A的连接，发送一个FIN给客户端A(报文段6)。</p><p>（4）客户端A发回ACK报文确认，并将确认序号设置为收到序号加1(报文段7)。</p><p>TCP采用四次挥手关闭连接如图2所示。</p><p>​                图2  TCP四次挥手关闭连接</p><p><strong>1．为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？</strong></p><p>这是因为服务端的LISTEN状态下的SOCKET当收到SYN报文的连接请求后，它可以把ACK和SYN(ACK起应答作用，而SYN起同步作用)放在一个报文里来发送。但关闭连接时，当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了，所以你可能未必会马上会关闭SOCKET,也即你可能还需要发送一些数据给对方之后，再发送FIN报文给对方来表示你同意现在可以关闭连接了，所以它这里的ACK报文和FIN报文多数情况下都是分开发送的。 </p><p><strong>2．为什么TIME_WAIT状态还需要等2MSL后才能返回到CLOSED状态？</strong></p><p><strong>这个问题可以参考《unix 网络编程》（第三版，2.7 TIME_WAIT状态）。</strong></p><p><strong>TIME_WAIT状态由两个存在的理由。</strong></p><p><strong><em>\</em>（1）可靠的实现TCP全双工链接的终止。**</strong></p><p>这是因为虽然双方都同意关闭连接了，而且握手的4个报文也都协调和发送完毕，按理可以直接回到CLOSED状态（就好比从SYN_SEND状态到ESTABLISH状态那样）；但是因为我们必须要假想网络是不可靠的，你无法保证你最后发送的ACK报文会一定被对方收到，因此对方处于LAST_ACK状态下的SOCKET可能会因为超时未收到ACK报文，而重发FIN报文，所以这个TIME_WAIT状态的作用就是用来重发可能丢失的ACK报文。</p><p> （2）允许老的重复的分节在网络中消逝。</p><p>假 设在12.106.32.254的1500端口和206.168.1.112.219的21端口之间有一个TCP连接。我们关闭这个链接，过一段时间后在 相同的IP地址和端口建立另一个连接。后一个链接成为前一个的化身。因为它们的IP地址和端口号都相同。TCP必须防止来自某一个连接的老的重复分组在连 接已经终止后再现，从而被误解成属于同一链接的某一个某一个新的化身。为做到这一点，TCP将不给处于TIME_WAIT状态的链接发起新的化身。既然 TIME_WAIT状态的持续时间是MSL的2倍，这就足以让某个方向上的分组最多存活msl秒即被丢弃，另一个方向上的应答最多存活msl秒也被丢弃。 通过实施这个规则，我们就能保证每成功建立一个TCP连接时。来自该链接先前化身的重复分组都已经在网络中消逝了。</p><p><strong>3. 为什么不能用两次握手进行连接？</strong></p><p>我们知道，3次握手完成两个重要的功能，既要双方做好发送数据的准备工作(双方都知道彼此已准备好)，也要允许双方就初始序列号进行协商，这个序列号在握手过程中被发送和确认。<br>  现在把三次握手改成仅需要两次握手，死锁是可能发生的。作为例子，考虑计算机S和C之间的通信，假定C给S发送一个连接请求分组，S收到了这个分组，并发 送了确认应答分组。按照两次握手的协定，S认为连接已经成功地建立了，可以开始发送数据分组。可是，C在S的应答分组在传输中被丢失的情况下，将不知道S 是否已准备好，不知道S建立什么样的序列号，C甚至怀疑S是否收到自己的连接请求分组。在这种情况下，C认为连接还未建立成功，将忽略S发来的任何数据分 组，只等待连接确认应答分组。而S在发出的分组超时后，重复发送同样的分组。这样就形成了死锁。 </p><p><strong>补充：</strong></p><p>a. 默认情况下(不改变socket选项)，当你调用close( or closesocket，以下说close不再重复)时，如果发送缓冲中还有数据，TCP会继续把数据发送完。</p><p>b. 发送了FIN只是表示这端不能继续发送数据(应用层不能再调用send发送)，但是还可以接收数据。</p><p>c. 应用层如何知道对端关闭？通常，在最简单的阻塞模型中，当你调用recv时，如果返回0，则表示对端关闭。在这个时候通常的做法就是也调用close，那么TCP层就发送FIN，继续完成四次握手。如果你不调用close，那么对端就会处于FIN_WAIT_2状态，而本端则会处于CLOSE_WAIT状态。这个可以写代码试试。</p><p>d. 在很多时候，TCP连接的断开都会由TCP层自动进行，例如你CTRL+C终止你的程序，TCP连接依然会正常关闭，你可以写代码试试。</p><p><strong>插曲：</strong> </p><p>  特别的TIME_WAIT状态：</p><p>  从以上TCP连接关闭的状态转换图可以看出，主动关闭的一方在发送完对对方FIN报文的确认(ACK)报文后，会进入TIME_WAIT状态。TIME_WAIT状态也称为2MSL状态。</p><p>  什么是2MSL？MSL即Maximum Segment Lifetime，也就是报文最大生存时间，引用《TCP/IP详解》中的话：“它(MSL)是任何报文段被丢弃前在网络内的最长时间。”那么，2MSL也就是这个时间的2倍。其实我觉得没必要把这个MSL的确切含义搞明白，你所需要明白的是，当TCP连接完成四个报文段的交换时，主动关闭的一方将继续等待一定时间(2-4分钟)，即使两端的应用程序结束。你可以写代码试试，然后用setstat查看下。</p><p>  为什么需要2MSL？根据《TCP/IP详解》和《The TCP/IP Guide》中的说法，有两个原因：</p><p>  其一，保证发送的ACK会成功发送到对方，如何保证？我觉得可能是通过超时计时器发送。这个就很难用代码演示了。</p><p>  其二，报文可能会被混淆，意思是说，其他时候的连接可能会被当作本次的连接。直接引用《The TCP/IP Guide》的说法：The second is to provide a “buffering period” between the end of this connection and any subsequent ones. If not for this period, it is possible that packets from different connections could be mixed, creating confusion.</p><p>  TIME_WAIT状态所带来的影响：</p><p>  当某个连接的一端处于TIME_WAIT状态时，该连接将不能再被使用。事实上，对于我们比较有现实意义的是，这个端口将不能再被使用。某个端口处于TIME_WAIT状态(其实应该是这个连接)时，这意味着这个TCP连接并没有断开(完全断开)，那么，如果你bind这个端口，就会失败。对于服务器而言，如果服务器突然crash掉了，那么它将无法再2MSL内重新启动，因为bind会失败。解决这个问题的一个方法就是设置socket的SO_REUSEADDR选项。这个选项意味着你可以重用一个地址。</p><p>  对于TIME_WAIT的插曲：</p><p>  当建立一个TCP连接时，服务器端会继续用原有端口监听，同时用这个端口与客户端通信。而客户端默认情况下会使用一个随机端口与服务器端的监听端口通信。有时候，为了服务器端的安全性，我们需要对客户端进行验证，即限定某个IP某个特定端口的客户端。客户端可以使用bind来使用特定的端口。对于服务器端，当设置了SO_REUSEADDR选项时，它可以在2MSL内启动并listen成功。但是对于客户端，当使</p><p>用bind并设置SO_REUSEADDR时，如果在2MSL内启动，虽然bind会成功，但是在windows平台上connect会失败。而在linux上则不存在这个问题。(我的实验平台：winxp, ubuntu7.10)</p><p>  要解决windows平台的这个问题，可以设置SO_LINGER选项。SO_LINGER选项决定调用close时TCP的行为。SO_LINGER涉及到linger结构体，如果设置结构体中l_onoff为非0，l_linger为0，那么调用close时TCP连接会立刻断开，TCP不会将发送缓冲中未发送的数据发送，而是立即发送一个RST报文给对方，这个时候TCP连接就不会进入TIME_WAIT状态。如你所见，这样做虽然解决了问题，但是并不安全。通过以上方式设置SO_LINGER状态，等同于设置SO_DONTLINGER状态。</p><p>  断开连接时的意外：</p><p>  这个算不上断开连接时的意外，当TCP连接发生一些物理上的意外情况时，例如网线断开，linux上的TCP实现会依然认为该连接有效，而windows则会在一定时间后返回错误信息。这似乎可以通过设置SO_KEEPALIVE选项来解决，不过不知道这个选项是否对于所有平台都有效。</p><h4 id="第三部分：常见面试题"><a href="#第三部分：常见面试题" class="headerlink" title="第三部分：常见面试题"></a><strong>第三部分：常见面试题</strong></h4><ul><li><ul><li><p>TCP协议和UDP协议的区别是什么</p></li><li><ul><li>TCP协议是有连接的，有连接的意思是开始传输实际数据之前TCP的客户端和服务器端必须通过三次握手建立连接，会话结束之后也要结束连接。而UDP是无连接的</li><li>TCP协议保证数据按序发送，按序到达，提供超时重传来保证可靠性，但是UDP不保证按序到达，甚至不保证到达，只是努力交付，即便是按序发送的序列，也不保证按序送到。</li><li>TCP协议所需资源多，TCP首部需20个字节（不算可选项），UDP首部字段只需8个字节。</li><li>TCP有流量控制和拥塞控制，UDP没有，网络拥堵不会影响发送端的发送速率</li><li>TCP是一对一的连接，而UDP则可以支持一对一，多对多，一对多的通信。</li><li>TCP面向的是字节流的服务，UDP面向的是报文的服务。</li><li><a href="http://www.cnblogs.com/newwy/archive/2013/08/02/3232503.html">TCP介绍</a>和UDP介绍</li></ul></li><li><p>请详细介绍一下TCP协议建立连接和终止连接的过程？</p></li><li><ul><li><p>助于理解的<a href="http://www.cppblog.com/MemoryGarden/archive/2011/07/02/150007.html">一段话</a></p></li><li><p>两幅图（<a href="http://www.cnblogs.com/newwy/archive/2013/08/03/3234536.html">来源</a>）：</p></li><li><ul><li>建立连接：三次握手</li><li><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImg/tcp.png"></li><li>关闭连接：四次挥手</li><li><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://images0.cnblogs.com/blog/385532/201308/30193703-330b281cddc5439f99eb027ac1c9627c.png"></li></ul></li></ul></li><li><p>三次握手建立连接时，发送方再次发送确认的必要性？</p></li><li><ul><li><ul><li>主 要是为了防止已失效的连接请求报文段突然又传到了B,因而产生错误。假定出现一种异常情况，即A发出的第一个连接请求报文段并没有丢失，而是在某些网络结 点长时间滞留了，一直延迟到连接释放以后的某个时间才到达B，本来这是一个早已失效的报文段。但B收到此失效的连接请求报文段后，就误认为是A又发出一次 新的连接请求，于是就向A发出确认报文段，同意建立连接。假定不采用三次握手，那么只要B发出确认，新的连接就建立了，这样一直等待A发来数据，B的许多 资源就这样白白浪费了。</li></ul></li></ul></li><li><p>四次挥手释放连接时，等待2MSL的意义？</p></li><li><ul><li><ul><li>第 一，为了保证A发送的最有一个ACK报文段能够到达B。这个ACK报文段有可能丢失，因而使处在LAST-ACK状态的B收不到对已发送的FIN和ACK 报文段的确认。B会超时重传这个FIN和ACK报文段，而A就能在2MSL时间内收到这个重传的ACK+FIN报文段。接着A重传一次确认。</li><li>第二，就是防止上面提到的已失效的连接请求报文段出现在本连接中，A在发送完最有一个ACK报文段后，再经过2MSL，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。</li></ul></li></ul></li></ul></li></ul><ul><li><ul><li><p>常见的应用中有哪些是应用TCP协议的，哪些又是应用UDP协议的，为什么它们被如此设计？</p></li><li><ul><li><p>以下应用一般或必须用udp实现？</p></li><li><ul><li>多播的信息一定要用udp实现，因为tcp只支持一对一通信。</li><li>如果一个应用场景中大多是简短的信息，适合用udp实现，因为udp是基于报文段的，它直接对上层应用的数据封装成报文段，然后丢在网络中，如果信息量太大，会在链路层中被分片，影响传输效率。</li><li>如果一个应用场景重性能甚于重完整性和安全性，那么适合于udp，比如多媒体应用，缺一两帧不影响用户体验，但是需要流媒体到达的速度快，因此比较适合用udp</li><li>如果要求快速响应，那么udp听起来比较合适</li><li>如果又要利用udp的快速响应优点，又想可靠传输，那么只能考上层应用自己制定规则了。</li><li>常见的使用udp的例子：ICQ,QQ的聊天模块。</li></ul></li><li><p>以qq为例的一个说明（转载自<a href="http://www.zhihu.com/question/20292749">知乎</a>）</p></li></ul></li></ul></li></ul><p>登陆采用TCP协议和HTTP协议，你和好友之间发送消息，主要采用UDP协议，内网传文件采用了P2P技术。总来的说：<br>1.登陆过程，客户端client 采用TCP协议向服务器server发送信息，HTTP协议下载信息。登陆之后，会有一个TCP连接来保持在线状态。<br>2.和好友发消息，客户端client采用UDP协议，但是需要通过服务器转发。腾讯为了确保传输消息的可靠，采用上层协议来保证可靠传输。如果消息发送失败，客户端会提示消息发送失败，并可重新发送。<br>3.如果是在内网里面的两个客户端传文件，QQ采用的是P2P技术，不需要服务器中转。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> 网络通信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>响应式布局的常用解决方案对比</title>
      <link href="2021/01/11/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94/"/>
      <url>2021/01/11/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94/</url>
      
        <content type="html"><![CDATA[<p>简要介绍：前端开发中，静态网页通常需要适应不同分辨率的设备，常用的自适应解决方案包括媒体查询、百分比、rem和vw/vh等。本文从px单位出发，分析了px在移动端布局中的不足，接着介绍了几种不同的自适应解决方案。</p><blockquote><ul><li>px和视口</li><li>媒体查询</li><li>百分比</li><li>自适应场景下的rem解决方案</li><li>通过vw/vh来实现自适应</li></ul></blockquote><h2 id="一、px和视口"><a href="#一、px和视口" class="headerlink" title="一、px和视口"></a>一、px和视口</h2><p>在静态网页中，我们经常用像素（px）作为单位，来描述一个元素的宽高以及定位信息。在pc端，通常认为css中,1px所表示的真实长度是固定的。</p><p><strong><em>那么，px真的是一个设备无关，跟长度单位米和分米一样是固定大小的吗？</em></strong></p><p>答案是否定的，下面图1.1和图1.2分别表示pc端下和移动端下的显示结果，在网页中我们设置的font-size统一为16px。</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/d4da55afe41e53b3dac82469f3d47430c09585d8.jpeg" alt="d4da55afe41e53b3dac82469f3d47430c09585d8"></p><p>图1.1 pc端下font-size为16px时的显示结果</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/c5288ab0897642624d3c672997fc97332da7635d.jpeg" alt="c5288ab0897642624d3c672997fc97332da7635d"></p><p>图1.2 移动端下font-size为16px时的显示结果</p><p>从上面两幅图的对比可以看出，字体都是16px，显然在pc端中文字正常显示，而在移动端文字很小，几乎看不到，说明在css中1px并不是固定大小，直观从我们发现在移动端1px所表示的长度较小，所以导致文字显示不清楚。</p><p><strong><em>那么css中的1px的真实长度到底由什么决定呢？\</em></strong></p><p>为了理清楚这个概念我们首先介绍像素和视口的概念</p><h3 id="1-像素"><a href="#1-像素" class="headerlink" title="1. 像素"></a>1. 像素</h3><p>像素是网页布局的基础，一个像素表示了计算机屏幕所能显示的最小区域，像素分为两种类型：css像素和物理像素。</p><p>我们在js或者css代码中使用的px单位就是指的是css像素，物理像素也称设备像素，只与设备或者说硬件有关，同样尺寸的屏幕，设备的密度越高，物理像素也就越多。下表表示css像素和物理像素的具体区别：</p><table><thead><tr><th align="left">css像素</th><th align="center">为web开发者提供，在css中使用的一个抽象单位</th></tr></thead><tbody><tr><td align="left">物理像素</td><td align="center">只与设备的硬件密度有关，任何设备的物理像素都是固定的</td></tr></tbody></table><p>那么css像素与物理像素的转换关系是怎么样的呢？为了明确css像素和物理像素的转换关系，必须先了解视口是什么。</p><h3 id="2-视口"><a href="#2-视口" class="headerlink" title="2. 视口"></a>2. 视口</h3><p>广义的视口，是指浏览器显示内容的屏幕区域，狭义的视口包括了布局视口、视觉视口和理想视口</p><h3 id="1-布局视口（layout-viewport）"><a href="#1-布局视口（layout-viewport）" class="headerlink" title="(1) 布局视口（layout viewport）"></a>(1) 布局视口（layout viewport）</h3><p>布局视口定义了pc网页在移动端的默认布局行为，因为通常pc的分辨率较大，布局视口默认为980px。也就是说在不设置网页的viewport的情况下，pc端的网页默认会以布局视口为基准，在移动端进行展示。因此我们可以明显看出来，默认为布局视口时，根植于pc端的网页在移动端展示很模糊。</p><h3 id="2-视觉视口（visual-viewport）"><a href="#2-视觉视口（visual-viewport）" class="headerlink" title="(2) 视觉视口（visual viewport）"></a>(2) 视觉视口（visual viewport）</h3><p>视觉视口表示浏览器内看到的网站的显示区域，用户可以通过缩放来查看网页的显示内容，从而改变视觉视口。视觉视口的定义，就像拿着一个放大镜分别从不同距离观察同一个物体，视觉视口仅仅类似于放大镜中显示的内容，因此视觉视口不会影响布局视口的宽度和高度。</p><h3 id="3-理想视口（ideal-viewport）"><a href="#3-理想视口（ideal-viewport）" class="headerlink" title="(3) 理想视口（ideal viewport）"></a>(3) 理想视口（ideal viewport）</h3><p>理想视口或者应该全称为“理想的布局视口”，在移动设备中就是指设备的分辨率。换句话说，理想视口或者说分辨率就是给定设备物理像素的情况下，最佳的“布局视口”。</p><p><strong><em>上述视口中，最重要的是要明确理想视口的概念，在移动端中，理想视口或者说分辨率跟物理像素之间有什么关系呢？\</em></strong></p><p>为了理清分辨率和物理像素之间的联系，我们介绍一个用DPR（Device pixel ratio）设备像素比来表示，则可以写成：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 DPR &#x3D; 物理像素／分辨率</span><br></pre></td></tr></table></figure><p>在不缩放的情况下，一个css像素就对应一个dpr，也就是说，在不缩放</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 CSS像素 &#x3D; 物理像素／分辨率</span><br><span class="line">此外，在移动端的布局中，我们可以通过viewport元标签来控制布局，比如一般情况下，我们可以通过下述标签使得移动端在理想视口下布局：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;meta id&#x3D;&quot;viewport&quot; name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width; initial-scale&#x3D;1.0; maximum-scale&#x3D;1; user-scalable&#x3D;no;&quot;&gt;</span><br></pre></td></tr></table></figure><p>上述meta标签的每一个属性的详细介绍如下：</p><table><thead><tr><th align="left">属性名</th><th align="center">取值</th><th align="right">描述</th></tr></thead><tbody><tr><td align="left">width</td><td align="center">正整数</td><td align="right">定义布局视口的宽度，单位为像素</td></tr><tr><td align="left">height</td><td align="center">正整数</td><td align="right">定义布局视口的高度，单位为像素，很少使用</td></tr><tr><td align="left">initial-scale</td><td align="center">[0,10]</td><td align="right">初始缩放比例，1表示不缩放</td></tr><tr><td align="left">minimum-scale</td><td align="center">[0,10]</td><td align="right">最小缩放比例</td></tr><tr><td align="left">maximum-scale</td><td align="center">[0,10]</td><td align="right">最大缩放比例</td></tr><tr><td align="left">user-scalable</td><td align="center">yes／no</td><td align="right">是否允许手动缩放页面，默认值为yes</td></tr></tbody></table><p>其中我们来看width属性，在移动端布局时，在meta标签中我们会将width设置称为device-width，device-width一般是表示分辨率的宽，通过width=device-width的设置我们就将布局视口设置成了理想的视口。</p><h3 id="3-px与自适应"><a href="#3-px与自适应" class="headerlink" title="3. px与自适应"></a>3. px与自适应</h3><p>上述我们了解到了当通过viewport元标签，设置布局视口为理想视口时，1个css像素可以表示成：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 CSS像素 &#x3D; 物理像素／分辨率</span><br></pre></td></tr></table></figure><p>我们直到，在pc端的布局视口通常情况下为980px，移动端以iphone6为例，分辨率为375 * 667，也就是说布局视口在理想的情况下为375px。比如现在我们有一个750px * 1134px的视觉稿，那么在pc端，一个css像素可以如下计算：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PC端： 1 CSS像素 &#x3D; 物理像素／分辨率 &#x3D; 750 ／ 980 &#x3D;0.76 px</span><br></pre></td></tr></table></figure><p>而在iphone6下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iphone6：1 CSS像素 &#x3D; 物理像素 ／分辨率 &#x3D; 750 ／ 375 &#x3D; 2 px</span><br></pre></td></tr></table></figure><p>也就是说在PC端，一个CSS像素可以用0.76个物理像素来表示，而iphone6中 一个CSS像素表示了2个物理像素。此外不同的移动设备分辨率不同，也就是1个CSS像素可以表示的物理像素是不同的，因此如果在css中仅仅通过px作为长度和宽度的单位，造成的结果就是无法通过一套样式，实现各端的自适应。</p><h2 id="二、媒体查询"><a href="#二、媒体查询" class="headerlink" title="二、媒体查询"></a>二、媒体查询</h2><p>在前面我们说到，不同端的设备下，在css文件中，1px所表示的物理像素的大小是不同的，因此通过一套样式，是无法实现各端的自适应。由此我们联想：</p><p><strong><em>如果一套样式不行，那么能否给每一种设备各一套不同的样式来实现自适应的效果？\</em></strong></p><p>答案是肯定的。</p><p>使用@media媒体查询可以针对不同的媒体类型定义不同的样式，特别是响应式页面，可以针对不同屏幕的大小，编写多套样式，从而达到自适应的效果。举例来说：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (max-width: 960px)&#123;</span><br><span class="line">    body&#123;</span><br><span class="line">      background-color:#FF6699</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (max-width: 768px)&#123;</span><br><span class="line">    body&#123;</span><br><span class="line">      background-color:#00FF66;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (max-width: 550px)&#123;</span><br><span class="line">    body&#123;</span><br><span class="line">      background-color:#6633FF;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media screen and (max-width: 320px)&#123;</span><br><span class="line">    body&#123;</span><br><span class="line">      background-color:#FFFF00;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述的代码通过媒体查询定义了几套样式，通过max-width设置样式生效时的最大分辨率，上述的代码分别对分辨率在0～320px，320px～550px，550px～768px以及768px～960px的屏幕设置了不同的背景颜色。</p><p>通过媒体查询，可以通过给不同分辨率的设备编写不同的样式来实现响应式的布局，比如我们为不同分辨率的屏幕，设置不同的背景图片。比如给小屏幕手机设置@2x图，为大屏幕手机设置@3x图，通过媒体查询就能很方便的实现。</p><p>但是媒体查询的缺点也很明显，如果在浏览器大小改变时，需要改变的样式太多，那么多套样式代码会很繁琐。</p><h2 id="三、百分比"><a href="#三、百分比" class="headerlink" title="三、百分比"></a>三、百分比</h2><p>除了用px结合媒体查询实现响应式布局外，我们也可以通过百分比单位 “ % “ 来实现响应式的效果。</p><p>比如当浏览器的宽度或者高度发生变化时，通过百分比单位，通过百分比单位可以使得浏览器中的组件的宽和高随着浏览器的变化而变化，从而实现响应式的效果。</p><p>为了了解百分比布局，首先要了解的问题是：</p><p><strong><em>css中的子元素中的百分比（%）到底是谁的百分比？\</em></strong></p><p>直观的理解，我们可能会认为子元素的百分比完全相对于直接父元素，height百分比相对于height，width百分比相对于width。当然这种理解是正确的，但是根据css的盒式模型，除了height、width属性外，还具有padding、border、margin等等属性。那么这些属性设置成百分比，是根据父元素的那些属性呢？此外还有border-radius和translate等属性中的百分比，又是相对于什么呢？下面来具体分析。</p><h3 id="1-百分比的具体分析"><a href="#1-百分比的具体分析" class="headerlink" title="1. 百分比的具体分析"></a>1. 百分比的具体分析</h3><p>（1）子元素height和width的百分比</p><p>子元素的height或width中使用百分比，是相对于子元素的直接父元素，width相对于父元素的width，height相对于父元素的height。比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;child&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>如果设置： .father{ width:200px; height:100px; } .child{ width:50%; height:50%; } 展示的效果为：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/095385dfa2b302b4c7fc96d63953d0b34e7151e2.jpeg" alt="095385dfa2b302b4c7fc96d63953d0b34e7151e2"></p><p>(2) top和bottom 、left和right</p><p>子元素的top和bottom如果设置百分比，则相对于直接非static定位(默认定位)的父元素的高度，同样</p><p>子元素的left和right如果设置百分比，则相对于直接非static定位(默认定位的)父元素的宽度。</p><p>展示的效果为：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/0a7f362a59eef4e5f1c4a80772bcf970931d06eb.jpeg" alt="0a7f362a59eef4e5f1c4a80772bcf970931d06eb"></p><p>（3）padding</p><p>子元素的padding如果设置百分比，不论是垂直方向或者是水平方向，都相对于直接父亲元素的width，而与父元素的height无关。</p><p>举例来说：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.parent&#123;</span><br><span class="line">  width:200px;</span><br><span class="line">  height:100px;</span><br><span class="line">  background:green;</span><br><span class="line">&#125;</span><br><span class="line">.child&#123;</span><br><span class="line">  width:0px;</span><br><span class="line">  height:0px;</span><br><span class="line">  background:blue;</span><br><span class="line">  color:white;</span><br><span class="line">  padding-top:50%;</span><br><span class="line">  padding-left:50%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>展示的效果为：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/5d0ec79029e3b4a6d737043a84a4040a43bf7afa.jpeg" alt="5d0ec79029e3b4a6d737043a84a4040a43bf7afa"></p><p>子元素的初始宽高为0，通过padding可以将父元素撑大，上图的蓝色部分是一个正方形，且边长为100px,说明padding不论宽高，如果设置成百分比都相对于父元素的width。</p><p>（4）margin</p><p>跟padding一样，margin也是如此，子元素的margin如果设置成百分比，不论是垂直方向还是水平方向，都相对于直接父元素的width。这里就不具体举例。</p><p>（5）border-radius</p><p>border-radius不一样，如果设置border-radius为百分比，则是相对于自身的宽度，举例来说：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;trangle&quot;&gt;&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>设置border-radius为百分比：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.trangle&#123;</span><br><span class="line">  width:100px;</span><br><span class="line">  height:100px;</span><br><span class="line">  border-radius:50%;</span><br><span class="line">  background:blue;</span><br><span class="line">  margin-top:10px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>展示效果为：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/43297bfa824e5c901bb82e702f13670a2c3b902e.jpeg" alt="43297bfa824e5c901bb82e702f13670a2c3b902e"></p><p>除了border-radius外，还有比如translate、background-size等都是相对于自身的，这里就不一一举例。</p><h3 id="2-百分比单位布局应用"><a href="#2-百分比单位布局应用" class="headerlink" title="2. 百分比单位布局应用"></a>2. 百分比单位布局应用</h3><p>百分比单位在布局上应用还是很广泛的，这里介绍一种应用。</p><p>比如我们要实现一个固定长宽比的长方形，比如要实现一个长宽比为4:3的长方形,我们可以根据padding属性来实现，因为padding不管是垂直方向还是水平方向，百分比单位都相对于父元素的宽度，因此我们可以设置padding-top为百分比来实现，长宽自适应的长方形：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;trangle&quot;&gt;&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>设置样式让其自适应：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.trangle&#123;</span><br><span class="line">  height:0;</span><br><span class="line">  width:100%;</span><br><span class="line">  padding-top:75%;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过设置padding-top：75%,相对比宽度的75%，因此这样就设置了一个长宽高恒定比例的长方形，具体效果展示如下：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/9d937a0c943266518a7d20fa76222ba2ee8e5d44.jpeg" alt="9d937a0c943266518a7d20fa76222ba2ee8e5d44"></p><h3 id="3-百分比单位缺点"><a href="#3-百分比单位缺点" class="headerlink" title="3. 百分比单位缺点"></a>3. 百分比单位缺点</h3><p>从上述对于百分比单位的介绍我们很容易看出如果全部使用百分比单位来实现响应式的布局，有明显的以下两个缺点：</p><p>（1）计算困难，如果我们要定义一个元素的宽度和高度，按照设计稿，必须换算成百分比单位。 （2）从小节1可以看出，各个属性中如果使用百分比，相对父元素的属性并不是唯一的。比如width和height相对于父元素的width和height，而margin、padding不管垂直还是水平方向都相对比父元素的宽度、border-radius则是相对于元素自身等等，造成我们使用百分比单位容易使布局问题变得复杂。</p><h2 id="四、自适应场景下的rem解决方案"><a href="#四、自适应场景下的rem解决方案" class="headerlink" title="四、自适应场景下的rem解决方案"></a>四、自适应场景下的rem解决方案</h2><h3 id="1-rem单位"><a href="#1-rem单位" class="headerlink" title="1. rem单位"></a>1. rem单位</h3><p>首先来看，什么是rem单位。rem是一个灵活的、可扩展的单位，由浏览器转化像素并显示。与em单位不同，rem单位无论嵌套层级如何，都只相对于浏览器的根元素（HTML元素）的font-size。默认情况下，html元素的font-size为16px，所以：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 rem &#x3D; 12px</span><br></pre></td></tr></table></figure><p>为了计算方便，通常可以将html的font-size设置成：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">html&#123; font-size: 62.5% &#125;</span><br></pre></td></tr></table></figure><p>这种情况下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 rem &#x3D; 10px</span><br></pre></td></tr></table></figure><h3 id="2-通过rem来实现响应式布局"><a href="#2-通过rem来实现响应式布局" class="headerlink" title="2.通过rem来实现响应式布局"></a>2.通过rem来实现响应式布局</h3><p>rem单位都是相对于根元素html的font-size来决定大小的,根元素的font-size相当于提供了一个基准，当页面的size发生变化时，只需要改变font-size的值，那么以rem为固定单位的元素的大小也会发生响应的变化。<br>因此，如果通过rem来实现响应式的布局，只需要根据视图容器的大小，动态的改变font-size即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function refreshRem() &#123;</span><br><span class="line">    var docEl &#x3D; doc.documentElement;</span><br><span class="line">    var width &#x3D; docEl.getBoundingClientRect().width;</span><br><span class="line">    var rem &#x3D; width &#x2F; 10;</span><br><span class="line">    docEl.style.fontSize &#x3D; rem + &#39;px&#39;;</span><br><span class="line">    flexible.rem &#x3D; win.rem &#x3D; rem;</span><br><span class="line">&#125;</span><br><span class="line">win.addEventListener(&#39;resize&#39;, refreshRem);</span><br></pre></td></tr></table></figure><p>上述代码中将视图容器分为10份，font-size用十分之一的宽度来表示，最后在header标签中执行这段代码，就可以动态定义font-size的大小，从而1rem在不同的视觉容器中表示不同的大小，用rem固定单位可以实现不同容器内布局的自适应。</p><h3 id="3-rem2px和px2rem"><a href="#3-rem2px和px2rem" class="headerlink" title="3. rem2px和px2rem"></a>3. rem2px和px2rem</h3><p>如果在响应式布局中使用rem单位，那么存在一个单位换算的问题，rem2px表示从rem换算成px，这个就不说了，只要rem乘以相应的font-size中的大小，就能换算成px。更多的应用是px2rem，表示的是从px转化为rem。</p><p>比如给定的视觉稿为750px（物理像素），如果我们要将所有的布局单位都用rem来表示，一种比较笨的办法就是对所有的height和width等元素，乘以相应的比例，现将视觉稿换算成rem单位，然后一个个的用rem来表示。另一种比较方便的解决方法就是，在css中我们还是用px来表示元素的大小，最后编写完css代码之后，将css文件中的所有px单位，转化成rem单位。</p><p>px2rem的原理也很简单，重点在于预处理以px为单位的css文件，处理后将所有的px变成rem单位。可以通过两种方式来实现：</p><p>1） webpack loader的形式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install px2rem-loader</span><br></pre></td></tr></table></figure><p>在webpack的配置文件中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">      test: &#x2F;\.css$&#x2F;,</span><br><span class="line">      use: [&#123;</span><br><span class="line">        loader: &#39;style-loader&#39;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: &#39;css-loader&#39;</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        loader: &#39;px2rem-loader&#39;,</span><br><span class="line">        &#x2F;&#x2F; options here</span><br><span class="line">        options: &#123;</span><br><span class="line">          remUni: 75,</span><br><span class="line">          remPrecision: 8</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2）webpack中使用postcss plugin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install postcss-loader</span><br></pre></td></tr></table></figure><p>在webpack的plugin中:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var px2rem &#x3D; require(&#39;postcss-px2rem&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  module: &#123;</span><br><span class="line">    loaders: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: &#x2F;\.css$&#x2F;,</span><br><span class="line">        loader: &quot;style-loader!css-loader!postcss-loader&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  postcss: function() &#123;</span><br><span class="line">    return [px2rem(&#123;remUnit: 75&#125;)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-rem-布局应用举例"><a href="#4-rem-布局应用举例" class="headerlink" title="4. rem 布局应用举例"></a>4. rem 布局应用举例</h3><p>网易新闻的移动端页面使用了rem布局，具体例子如下：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/62066714035afd0bcb07228dc1bce11750089945.jpeg" alt="62066714035afd0bcb07228dc1bce11750089945"></p><h3 id="5-rem-布局的缺点"><a href="#5-rem-布局的缺点" class="headerlink" title="5. rem 布局的缺点"></a>5. rem 布局的缺点</h3><p>通过rem单位，可以实现响应式的布局，特别是引入相应的postcss相关插件，免去了设计稿中的px到rem的计算。rem单位在国外的一些网站也有使用，这里所说的rem来实现布局的缺点，或者说是小缺陷是：</p><p><strong><em>在响应式布局中，必须通过js来动态控制根元素font-size的大小。</em></strong></p><p>也就是说css样式和js代码有一定的耦合性。且必须将改变font-size的代码放在css样式之前。</p><h2 id="五-通过vw-vh来实现自适应"><a href="#五-通过vw-vh来实现自适应" class="headerlink" title="五. 通过vw/vh来实现自适应"></a>五. 通过vw/vh来实现自适应</h2><h3 id="1-什么是vw-vh"><a href="#1-什么是vw-vh" class="headerlink" title="1. 什么是vw/vh ?"></a>1. 什么是vw/vh ?</h3><p>css3中引入了一个新的单位vw/vh，与视图窗口有关，vw表示相对于视图窗口的宽度，vh表示相对于视图窗口高度，除了vw和vh外，还有vmin和vmax两个相关的单位。各个单位具体的含义如下：</p><table><thead><tr><th align="left">单位</th><th align="center">含义</th></tr></thead><tbody><tr><td align="left">vw</td><td align="center">相对于视窗的宽度，视窗宽度是100vw</td></tr><tr><td align="left">vh</td><td align="center">相对于视窗的高度，视窗高度是100vh</td></tr><tr><td align="left">vmin</td><td align="center">vw和vh中的较小值</td></tr><tr><td align="left">vmax</td><td align="center">vw和vh中的较大值</td></tr></tbody></table><p>这里我们发现视窗宽高都是100vw／100vh，那么vw或者vh，下简称vw，很类似百分比单位。vw和%的区别为：</p><table><thead><tr><th align="left">单位</th><th align="center">含义</th></tr></thead><tbody><tr><td align="left">%</td><td align="center">大部分相对于祖先元素，也有相对于自身的情况比如（border-radius、translate等)</td></tr><tr><td align="left">vw/vh</td><td align="center">相对于视窗的尺寸</td></tr></tbody></table><p>从对比中我们可以发现，vw单位与百分比类似，单确有区别，前面我们介绍了百分比单位的换算困难，这里的vw更像”理想的百分比单位”。任意层级元素，在使用vw单位的情况下，1vw都等于视图宽度的百分之一。</p><h3 id="2-vw单位换算"><a href="#2-vw单位换算" class="headerlink" title="2. vw单位换算"></a>2. vw单位换算</h3><p>同样的，如果要将px换算成vw单位，很简单，只要确定视图的窗口大小（布局视口），如果我们将布局视口设置成分辨率大小，比如对于iphone6/7 375*667的分辨率，那么px可以通过如下方式换算成vw：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1px &#x3D; （1&#x2F;375）*100 vw</span><br></pre></td></tr></table></figure><p>此外，也可以通过postcss的相应插件，预处理css做一个自动的转换，<a href="https://link.juejin.im/?target=https://github.com/evrone/postcss-px-to-viewport">postcss-px-to-viewport</a>可以自动将px转化成vw。 postcss-px-to-viewport的默认参数为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var defaults &#x3D; &#123;</span><br><span class="line">  viewportWidth: 320,</span><br><span class="line">  viewportHeight: 568, </span><br><span class="line">  unitPrecision: 5,</span><br><span class="line">  viewportUnit: &#39;vw&#39;,</span><br><span class="line">  selectorBlackList: [],</span><br><span class="line">  minPixelValue: 1,</span><br><span class="line">  mediaQuery: false</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>通过指定视窗的宽度和高度，以及换算精度，就能将px转化成vw。</p><h3 id="3-vw-vh单位的兼容性"><a href="#3-vw-vh单位的兼容性" class="headerlink" title="3. vw/vh单位的兼容性"></a>3. vw/vh单位的兼容性</h3><p>可以在<a href="https://caniuse.com/">https://caniuse.com/</a> 查看各个版本的浏览器对vw单位的支持性。</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://yqfile.alicdn.com/640ff82102d83bdf20eb1b8507b8767a38fcfff7.jpeg" alt="640ff82102d83bdf20eb1b8507b8767a38fcfff7"></p><p>从上图我们发现，绝大多数的浏览器支持vw单位，但是ie9-11不支持vmin和vmax，考虑到vmin和vmax单位不常用，vw单位在绝大部分高版本浏览器内的支持性很好，但是opera浏览器整体不支持vw单位，如果需要兼容opera浏览器的布局，不推荐使用vw。</p><p>小结：本文介绍在布局中常用的单位，比如px、%、rem和vw等等，以及不同的单位在响应式布局中的优缺点。</p><p>原文发布时间为：2018年07月02日</p><p>本文作者：<a href="https://juejin.im/user/5b398d15f265da59bf7a1167">yuxiaoliang</a></p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
            <tag> CSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js操作MySQL数据库</title>
      <link href="2021/01/11/Node-js%E6%93%8D%E4%BD%9CMySQL%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>2021/01/11/Node-js%E6%93%8D%E4%BD%9CMySQL%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h2 id="Node-js-连接-MySQL"><a href="#Node-js-连接-MySQL" class="headerlink" title="Node.js 连接 MySQL"></a>Node.js 连接 MySQL</h2><p>（1）安装 mysql 包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install mysql</span><br></pre></td></tr></table></figure><p>（2）引入 mysql 包：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>);</span><br></pre></td></tr></table></figure><p>（3）建立连接：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">  <span class="comment">//port:&quot;3306&quot;, //可选，默认3306</span></span><br><span class="line">  user: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  password: <span class="string">&#x27;xxx&#x27;</span>, <span class="comment">// 这里改成你自己的数据库连接密码</span></span><br><span class="line">  database: <span class="string">&quot;qiangu_database&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//创建与数据库进行连接的连接对象</span></span><br><span class="line"><span class="keyword">let</span> connection = mysql.createConnection(options);</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">connection.connect(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="comment">// 数据库连接成功</span></span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 数据库连接失败</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;数据库连接成功&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>正常来说，运行程序后，应该会提示<code>数据库连接成功</code>。</p><p>如果在运行时提示错误<code>Client does not support authentication protocol requested by server</code>，解决办法如下：(在终端进入 sql 之后，输入如下命令)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 注意，这里的 <span class="string">&#x27;root&#x27;</span> 请填你的<span class="keyword">user</span>账号， <span class="string">&#x27;localhost&#x27;</span> 请填 你的 host， <span class="string">&#x27;password&#x27;</span> 请填你的密码</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 然后执行如下命令</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h2 id="Node-js-增删改查-MySQL"><a href="#Node-js-增删改查-MySQL" class="headerlink" title="Node.js 增删改查 MySQL"></a>Node.js 增删改查 MySQL</h2><p>针对下面这张表：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://github.com/qianguyihao/Web/blob/master/img/20200418_1728.png"></p><p>通过 Node.js可以对其进行一些增删改查操作。代码举例如下。</p><h3 id="1、查询表"><a href="#1、查询表" class="headerlink" title="1、查询表"></a>1、查询表</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="comment">//port:&quot;3306&quot;,//可选，默认3306</span></span><br><span class="line">    user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;xxx&#x27;</span>, <span class="comment">// 这里改成你自己的数据库密码</span></span><br><span class="line">    database: <span class="string">&#x27;qiangu_database&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建与数据库进行连接的连接对象</span></span><br><span class="line"><span class="keyword">let</span> connection = mysql.createConnection(options);</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">connection.connect(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 数据库连接成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 数据库连接失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1、查询表</span></span><br><span class="line"><span class="keyword">let</span> strSql1 = <span class="string">&#x27;select * from qiangu_student_table&#x27;</span>;</span><br><span class="line">connection.query(strSql1, <span class="function">(<span class="params">err, result, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 表查询失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 表查询成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;qiangu_student_table 表查询结果：&#x27;</span> + <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;fields:&#x27;</span> + <span class="built_in">JSON</span>.stringify(fields));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>打印结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qiangu_student_table 表查询结果：</span><br><span class="line">[&#123;<span class="string">&quot;id&quot;</span>:1,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;千古壹号&quot;</span>,<span class="string">&quot;age&quot;</span>:28&#125;,&#123;<span class="string">&quot;id&quot;</span>:2,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;许嵩&quot;</span>,<span class="string">&quot;age&quot;</span>:34&#125;,&#123;<span class="string">&quot;id&quot;</span>:3,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;邓紫棋&quot;</span>,<span class="string">&quot;age&quot;</span>:28&#125;]</span><br><span class="line"></span><br><span class="line">fields:[</span><br><span class="line">    &#123;<span class="string">&quot;catalog&quot;</span>:<span class="string">&quot;def&quot;</span>,<span class="string">&quot;db&quot;</span>:<span class="string">&quot;qiangu_database&quot;</span>,<span class="string">&quot;table&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;orgTable&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;id&quot;</span>,<span class="string">&quot;orgName&quot;</span>:<span class="string">&quot;id&quot;</span>,<span class="string">&quot;charsetNr&quot;</span>:63,<span class="string">&quot;length&quot;</span>:11,<span class="string">&quot;type&quot;</span>:3,<span class="string">&quot;flags&quot;</span>:0,<span class="string">&quot;decimals&quot;</span>:0,<span class="string">&quot;zeroFill&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;catalog&quot;</span>:<span class="string">&quot;def&quot;</span>,<span class="string">&quot;db&quot;</span>:<span class="string">&quot;qiangu_database&quot;</span>,<span class="string">&quot;table&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;orgTable&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;name&quot;</span>,<span class="string">&quot;orgName&quot;</span>:<span class="string">&quot;name&quot;</span>,<span class="string">&quot;charsetNr&quot;</span>:33,<span class="string">&quot;length&quot;</span>:765,<span class="string">&quot;type&quot;</span>:253,<span class="string">&quot;flags&quot;</span>:0,<span class="string">&quot;decimals&quot;</span>:0,<span class="string">&quot;zeroFill&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;catalog&quot;</span>:<span class="string">&quot;def&quot;</span>,<span class="string">&quot;db&quot;</span>:<span class="string">&quot;qiangu_database&quot;</span>,<span class="string">&quot;table&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;orgTable&quot;</span>:<span class="string">&quot;qiangu_student_table&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;age&quot;</span>,<span class="string">&quot;orgName&quot;</span>:<span class="string">&quot;age&quot;</span>,<span class="string">&quot;charsetNr&quot;</span>:63,<span class="string">&quot;length&quot;</span>:11,<span class="string">&quot;type&quot;</span>:3,<span class="string">&quot;flags&quot;</span>:0,<span class="string">&quot;decimals&quot;</span>:0,<span class="string">&quot;zeroFill&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2、删除表</span></span><br><span class="line"><span class="keyword">let</span> strSql2 = <span class="string">&#x27;drop table test2_table&#x27;</span>;</span><br><span class="line">connection.query(strSql2, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 表删除失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 表删除成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;表删除成功：&#x27;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>打印结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">表删除成功：</span><br><span class="line">OkPacket &#123;</span><br><span class="line">    fieldCount: 0,</span><br><span class="line">    affectedRows: 0,</span><br><span class="line">    insertId: 0,</span><br><span class="line">    serverStatus: 2,</span><br><span class="line">    warningCount: 0,</span><br><span class="line">    message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    protocol41: <span class="literal">true</span>,</span><br><span class="line">    changedRows: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>将上方的sql语句换一下即可：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">let strSql3 <span class="operator">=</span> <span class="string">&#x27;drop database qiangu_database&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、新建数据库"><a href="#2、新建数据库" class="headerlink" title="2、新建数据库"></a>2、新建数据库</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="comment">//port:&quot;3306&quot;,//可选，默认3306</span></span><br><span class="line">    user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;smyhvae001&#x27;</span>,</span><br><span class="line">    <span class="comment">// database: &#x27;qiangu_database&#x27;  // 注意，因为代码里是创建新的数据库，所以这里不需要填其他的数据库名</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建与数据库进行连接的连接对象</span></span><br><span class="line"><span class="keyword">let</span> connection = mysql.createConnection(options);</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">connection.connect(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 数据库连接成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 数据库连接失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新的数据库</span></span><br><span class="line"><span class="keyword">const</span> strSql4 = <span class="string">&#x27;create database qiangu_database3&#x27;</span>;</span><br><span class="line">connection.query(strSql4, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;新建数据库成功：&#x27;</span> + <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>打印结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数据库连接成功</span><br><span class="line">新建数据库成功：&#123;</span><br><span class="line">    <span class="string">&quot;fieldCount&quot;</span>:0,<span class="string">&quot;affectedRows&quot;</span>:1,<span class="string">&quot;insertId&quot;</span>:0,<span class="string">&quot;serverStatus&quot;</span>:2,<span class="string">&quot;warningCount&quot;</span>:0,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;changedRows&quot;</span>:0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3、新建表"><a href="#3、新建表" class="headerlink" title="3、新建表"></a>3、新建表</h3><p>新建表的sql语句举例：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `qiangu_table5` (</span><br><span class="line">    `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `age` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (`id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>如果是在 js 代码中执行上面这样命令的话，要记得把 sql 语句存放在字符串里的同一行。</p><p>代码举例如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">    host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="comment">//port:&quot;3306&quot;,//可选，默认3306</span></span><br><span class="line">    user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password: <span class="string">&#x27;smyhvae001&#x27;</span>,</span><br><span class="line">    database: <span class="string">&#x27;qiangu_database&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建与数据库进行连接的连接对象</span></span><br><span class="line"><span class="keyword">let</span> connection = mysql.createConnection(options);</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">connection.connect(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 数据库连接成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 数据库连接失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建表</span></span><br><span class="line"><span class="comment">// 注意，在 js 代码中，sql 语句要存放在字符串里的同一行。</span></span><br><span class="line"><span class="keyword">const</span> strSql5 = <span class="string">&#x27;CREATE TABLE `qianguyihao_table5` (`id` int NOT NULL AUTO_INCREMENT,`name` varchar(255) DEFAULT NULL,`age` int DEFAULT NULL,PRIMARY KEY (`id`));&#x27;</span>;</span><br><span class="line"></span><br><span class="line">connection.query(strSql5, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 新建表失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 新建表成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;qianguyihao 新建表成功：&#x27;</span> + <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>打印结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数据库连接成功</span><br><span class="line">qianguyihao 新建表成功：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;fieldCount&quot;</span>:0,<span class="string">&quot;affectedRows&quot;</span>:0,<span class="string">&quot;insertId&quot;</span>:0,<span class="string">&quot;serverStatus&quot;</span>:2,<span class="string">&quot;warningCount&quot;</span>:0,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;changedRows&quot;</span>:0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="在指定的表中插入数据"><a href="#在指定的表中插入数据" class="headerlink" title="在指定的表中插入数据"></a>在指定的表中插入数据</h3><p>在指定的表中插入数据：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在指定的表中插入数据</span></span><br><span class="line"><span class="keyword">const</span> strSql6 = <span class="string">&quot;insert into qianguyihao_table5 (name, age) values (&#x27;千古壹号&#x27;, &#x27;28&#x27;)&quot;</span>;</span><br><span class="line"></span><br><span class="line">connection.query(strSql6, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 插入数据失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 在指定的表中插入数据成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;qianguyihao 在指定的表中插入数据成功：&#x27;</span> + <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>打印结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">qianguyihao 在指定的表中插入数据成功：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;fieldCount&quot;</span>:0,<span class="string">&quot;affectedRows&quot;</span>:1,<span class="string">&quot;insertId&quot;</span>:1,<span class="string">&quot;serverStatus&quot;</span>:2,<span class="string">&quot;warningCount&quot;</span>:0,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;protocol41&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;changedRows&quot;</span>:0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果插入的数据是变量（比如是用户提交上来的数据），那么，sql 语句可以这样写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在指定的表中插入数据（数据作为变量）</span></span><br><span class="line"><span class="keyword">const</span> strSql7 = <span class="string">&quot;insert into qianguyihao_table5 (name, age) values (?, ?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">connection.query(strSql7, [<span class="string">&#x27;许嵩&#x27;</span>, <span class="string">&#x27;34&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 插入数据失败</span></span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 在指定的表中插入数据成功</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;qiangauyihao 在指定的表中插入数据成功：&#x27;</span> + <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于websocket</title>
      <link href="2021/01/11/WEBsocket%E7%9A%84%E5%BC%95%E5%85%A5/"/>
      <url>2021/01/11/WEBsocket%E7%9A%84%E5%BC%95%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="WebSocket的引入"><a href="#WebSocket的引入" class="headerlink" title="WebSocket的引入"></a>WebSocket的引入</h2><h3 id="背景分析"><a href="#背景分析" class="headerlink" title="背景分析"></a>背景分析</h3><p>HTTP协议是无状态的，服务器只会响应来自客户端的请求，但是它与客户端之间不具备持续连接。</p><p>当用户在浏览器上进行操作时，可以请求服务器上的api；但是反过来却不可能：服务器端发生了一个事件，无法将这个事件的信息<strong>实时主动</strong>地通知客户端。只有在客户端查询服务器当前状态时，所发生事件的信息才会从服务器传递到客户端。</p><p>那怎么去实时地知道服务器的状态呢？方法有两个：</p><p>（1）<strong>轮询</strong>：客户端每隔很短的时间，都会对服务器发出请求，查看是否有新的消息，只要轮询速度足够快，例如1秒，就能给人造成交互是实时进行的印象。这种做法是无奈之举，实际上对服务器、客户端双方都造成了大量的性能浪费。</p><p>（2）<strong>长连接</strong>：客户端只请求一次，但是服务器会将连接保持，不会返回结果。当服务器有了新数据时，实时地发给客户端，而一直保持挂起状态。这种做法的也造成了大量的性能浪费。</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://www.runoob.com/wp-content/uploads/2016/03/ws.png"></p><h3 id="WebSocket-协议"><a href="#WebSocket-协议" class="headerlink" title="WebSocket 协议"></a>WebSocket 协议</h3><p>最新的 HTML5协议，制定了 WebSocket 协议标准，允许客户端和服务器端以<strong>全双工</strong>的方式进行通信。</p><p>WebSocket 的原理非常简单：利用HTTP请求产生握手，HTTP头部含有 WebSocket 协议的请求，*<em>握手之后，二者转用TCP协议进行交流</em>（QQ的协议）。</p><p>WebSocket协议需要浏览器和服务器都支持才可以使用：</p><ul><li><p>支持WebSocket协议的浏览器有：Chrome 4、火狐4、IE10、Safari5</p></li><li><p>支持WebSocket协议的服务器有：Node 0、Apach7.0.2、Nginx1.3</p></li></ul><h3 id="http-长连接和-websocket-的长连接区别"><a href="#http-长连接和-websocket-的长连接区别" class="headerlink" title="http 长连接和 websocket 的长连接区别"></a>http 长连接和 websocket 的长连接区别</h3><p>HTTP1.1通过使用Connection:keep-alive进行长连接，HTTP 1.1默认进行持久连接。在一次 TCP 连接中可以完成多个 HTTP 请求，但是对每个请求仍然要单独发 header，Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间。</p><p>websocket是一个真正的全双工。长连接第一次tcp链路建立之后，后续数据可以双方都进行发送，<strong>不需要发送请求头</strong>。</p><p>keep-alive双方并没有建立正真的连接会话，服务端可以在任何一次请求完成后关闭。WebSocket 它本身就规定了是正真的、双工的长连接，两边都必须要维持住连接的状态。</p><h3 id="Socket-IO-的引入"><a href="#Socket-IO-的引入" class="headerlink" title="Socket.IO 的引入"></a>Socket.IO 的引入</h3><p>Node.js上需要写一些程序，来处理TCP请求。</p><p>Node.js从诞生之日起，就支持 WebSocket 协议。不过，从底层一步一步搭建一个Socket服务器很费劲（想象一下Node写一个静态文件服务都那么费劲）。所以，有大神帮我们写了一个库 Socket.IO。</p><p>Socket.IO 是业界良心，新手福音。它屏蔽了所有底层细节，让顶层调用非常简单。并且还为不支持 WebSocket 协议的浏览器，提供了长轮询的透明模拟机制。</p><p>Node的单线程、非阻塞I/O、事件驱动机制，使它非常适合Socket服务器。</p><h3 id="Socket-IO-的安装"><a href="#Socket-IO-的安装" class="headerlink" title="Socket.IO 的安装"></a>Socket.IO 的安装</h3><p>Socket.IO 的官网是：<a href="http://socket.io/">http://socket.io/</a></p><p>安装方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io</span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> HTML5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【笔记】盒模型及应用</title>
      <link href="2021/01/08/%E7%9B%92%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/"/>
      <url>2021/01/08/%E7%9B%92%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="盒模型"><a href="#盒模型" class="headerlink" title="盒模型"></a>盒模型</h1><p>box：盒子，每个元素在页面中都会生成一个矩形区域（盒子）</p><p>盒子类型：</p><ol><li>行盒，display等于inline的元素</li><li>块盒，display等于block的元素</li></ol><p>行盒在页面中不换行、块盒独占一行</p><p>display默认值为inline</p><p>浏览器默认样式表设置的块盒：容器元素、h1~h6、p</p><p>常见的行盒：span、a、img、video、audio</p><h2 id="盒子的组成部分"><a href="#盒子的组成部分" class="headerlink" title="盒子的组成部分"></a>盒子的组成部分</h2><p>无论是行盒、还是块盒，都由下面几个部分组成，从内到外分别是：</p><ol><li>内容  content</li></ol><p>width、height，设置的是盒子内容的宽高</p><p>内容部分通常叫做整个盒子的<strong>内容盒 content-box</strong></p><ol start="2"><li>填充(内边距)  padding</li></ol><p>盒子边框到盒子内容的距离</p><p>padding-left、padding-right、padding-top、padding-bottom</p><p>padding: 简写属性</p><p>padding: 上 右 下 左</p><p>填充区+内容区 = <strong>填充盒 padding-box</strong></p><ol start="3"><li>边框  border</li></ol><p>边框 = 边框样式 + 边框宽度 + 边框颜色</p><p>边框样式：border-style<br>边框宽度：border-width<br>边框颜色：border-color</p><p>边框+填充区+内容区 = <strong>边框盒 border-box</strong></p><ol start="4"><li>外边距  margin</li></ol><p>边框到其他盒子的距离</p><p>margin-top、margin-left、margin-right、margin-bottom</p><p>速写属性margin</p><h1 id="盒模型应用"><a href="#盒模型应用" class="headerlink" title="盒模型应用"></a>盒模型应用</h1><h2 id="改变宽高范围"><a href="#改变宽高范围" class="headerlink" title="改变宽高范围"></a>改变宽高范围</h2><p>默认情况下，width 和 height 设置的是内容盒宽高。</p><blockquote><p>页面重构师：将psd文件（设计稿）制作为静态页面</p></blockquote><p>衡量设计稿尺寸的时候，往往使用的是边框盒，但设置width和height，则设置的是内容盒</p><ol><li>精确计算</li><li>CSS3：box-sizing</li></ol><h2 id="改变背景覆盖范围"><a href="#改变背景覆盖范围" class="headerlink" title="改变背景覆盖范围"></a>改变背景覆盖范围</h2><p>默认情况下，背景覆盖边框盒</p><p>可以通过background-clip进行修改</p><h2 id="溢出处理"><a href="#溢出处理" class="headerlink" title="溢出处理"></a>溢出处理</h2><p>overflow，控制内容溢出边框盒后的处理方式</p><h2 id="断词规则"><a href="#断词规则" class="headerlink" title="断词规则"></a>断词规则</h2><p>word-break，会影响文字在什么位置被截断换行</p><p>normal：普通。CJK字符（文字位置截断），非CJK字符（单词位置截断）</p><p>break-all：截断所有。所有字符都在文字处截断</p><p>keep-all：保持所有。所有文字都在单词之间截断</p><h2 id="空白处理"><a href="#空白处理" class="headerlink" title="空白处理"></a>空白处理</h2><p>white-space: nowrap</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录几段常用js代码的实现</title>
      <link href="2021/01/08/%E8%AE%B0%E5%BD%95%E5%87%A0%E6%AE%B5%E5%B8%B8%E7%94%A8js%E4%BB%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>2021/01/08/%E8%AE%B0%E5%BD%95%E5%87%A0%E6%AE%B5%E5%B8%B8%E7%94%A8js%E4%BB%A3%E7%A0%81%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>记录几段常用的js代码实现，掌握了实现原理，就对这些用法会有更加深入的理解。</p><h2 id="一、深拷贝"><a href="#一、深拷贝" class="headerlink" title="一、深拷贝"></a>一、深拷贝</h2><p>深拷贝，<a href="https://www.haorooms.com/post/js_deepcompare">深比较</a>，之前有文章写过，请看：<a href="https://www.haorooms.com/post/js_copy_sq">https://www.haorooms.com/post/js_copy_sq</a></p><p>今天的深copy考虑了Symbol属性，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">const cloneDeep1 &#x3D; (target, hash &#x3D; new WeakMap()) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; 对于传入参数处理</span><br><span class="line">  if (typeof target !&#x3D;&#x3D; &#39;object&#39; || target &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class="line">    return target;</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; 哈希表中存在直接返回</span><br><span class="line">  if (hash.has(target)) return hash.get(target);</span><br><span class="line"></span><br><span class="line">  const cloneTarget &#x3D; Array.isArray(target) ? [] : &#123;&#125;;</span><br><span class="line">  hash.set(target, cloneTarget);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 针对Symbol属性</span><br><span class="line">  const symKeys &#x3D; Object.getOwnPropertySymbols(target);</span><br><span class="line">  if (symKeys.length) &#123;</span><br><span class="line">    symKeys.forEach(symKey &#x3D;&gt; &#123;</span><br><span class="line">      if (typeof target[symKey] &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; target[symKey] !&#x3D;&#x3D; null) &#123;</span><br><span class="line">        cloneTarget[symKey] &#x3D; cloneDeep1(target[symKey]);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        cloneTarget[symKey] &#x3D; target[symKey];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  for (const i in target) &#123;</span><br><span class="line">    if (Object.prototype.hasOwnProperty.call(target, i)) &#123;</span><br><span class="line">      cloneTarget[i] &#x3D;</span><br><span class="line">        typeof target[i] &#x3D;&#x3D;&#x3D; &#39;object&#39; &amp;&amp; target[i] !&#x3D;&#x3D; null</span><br><span class="line">        ? cloneDeep1(target[i], hash)</span><br><span class="line">        : target[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return cloneTarget;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、Promise实现"><a href="#二、Promise实现" class="headerlink" title="二、Promise实现"></a>二、Promise实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 模拟实现Promise</span><br><span class="line">&#x2F;&#x2F; Promise利用三大手段解决回调地狱：</span><br><span class="line">&#x2F;&#x2F; 1. 回调函数延迟绑定</span><br><span class="line">&#x2F;&#x2F; 2. 返回值穿透</span><br><span class="line">&#x2F;&#x2F; 3. 错误冒泡</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 定义三种状态</span><br><span class="line">const PENDING &#x3D; &#39;PENDING&#39;;      &#x2F;&#x2F; 进行中</span><br><span class="line">const FULFILLED &#x3D; &#39;FULFILLED&#39;;  &#x2F;&#x2F; 已成功</span><br><span class="line">const REJECTED &#x3D; &#39;REJECTED&#39;;    &#x2F;&#x2F; 已失败</span><br><span class="line"></span><br><span class="line">class Promise &#123;</span><br><span class="line">  constructor(exector) &#123;</span><br><span class="line">    &#x2F;&#x2F; 初始化状态</span><br><span class="line">    this.status &#x3D; PENDING;</span><br><span class="line">    &#x2F;&#x2F; 将成功、失败结果放在this上，便于then、catch访问</span><br><span class="line">    this.value &#x3D; undefined;</span><br><span class="line">    this.reason &#x3D; undefined;</span><br><span class="line">    &#x2F;&#x2F; 成功态回调函数队列</span><br><span class="line">    this.onFulfilledCallbacks &#x3D; [];</span><br><span class="line">    &#x2F;&#x2F; 失败态回调函数队列</span><br><span class="line">    this.onRejectedCallbacks &#x3D; [];</span><br><span class="line"></span><br><span class="line">    const resolve &#x3D; value &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F; 只有进行中状态才能更改状态</span><br><span class="line">      if (this.status &#x3D;&#x3D;&#x3D; PENDING) &#123;</span><br><span class="line">        this.status &#x3D; FULFILLED;</span><br><span class="line">        this.value &#x3D; value;</span><br><span class="line">        &#x2F;&#x2F; 成功态函数依次执行</span><br><span class="line">        this.onFulfilledCallbacks.forEach(fn &#x3D;&gt; fn(this.value));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    const reject &#x3D; reason &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F; 只有进行中状态才能更改状态</span><br><span class="line">      if (this.status &#x3D;&#x3D;&#x3D; PENDING) &#123;</span><br><span class="line">        this.status &#x3D; REJECTED;</span><br><span class="line">        this.reason &#x3D; reason;</span><br><span class="line">        &#x2F;&#x2F; 失败态函数依次执行</span><br><span class="line">        this.onRejectedCallbacks.forEach(fn &#x3D;&gt; fn(this.reason))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">      &#x2F;&#x2F; 立即执行executor</span><br><span class="line">      &#x2F;&#x2F; 把内部的resolve和reject传入executor，用户可调用resolve和reject</span><br><span class="line">      exector(resolve, reject);</span><br><span class="line">    &#125; catch(e) &#123;</span><br><span class="line">      &#x2F;&#x2F; executor执行出错，将错误内容reject抛出去</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    onFulfilled &#x3D; typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : value &#x3D;&gt; value;</span><br><span class="line">    onRejected &#x3D; typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;? onRejected :</span><br><span class="line">      reason &#x3D;&gt; &#123; throw new Error(reason instanceof Error ? reason.message : reason) &#125;</span><br><span class="line">    &#x2F;&#x2F; 保存this</span><br><span class="line">    const self &#x3D; this;</span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">      if (self.status &#x3D;&#x3D;&#x3D; PENDING) &#123;</span><br><span class="line">        self.onFulfilledCallbacks.push(() &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; try捕获错误</span><br><span class="line">          try &#123;</span><br><span class="line">            &#x2F;&#x2F; 模拟微任务</span><br><span class="line">            setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">              const result &#x3D; onFulfilled(self.value);</span><br><span class="line">              &#x2F;&#x2F; 分两种情况：</span><br><span class="line">              &#x2F;&#x2F; 1. 回调函数返回值是Promise，执行then操作</span><br><span class="line">              &#x2F;&#x2F; 2. 如果不是Promise，调用新Promise的resolve函数</span><br><span class="line">              result instanceof Promise ? result.then(resolve, reject) : resolve(result);</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; catch(e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        self.onRejectedCallbacks.push(() &#x3D;&gt; &#123;</span><br><span class="line">          &#x2F;&#x2F; 以下同理</span><br><span class="line">          try &#123;</span><br><span class="line">            setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">              const result &#x3D; onRejected(self.reason);</span><br><span class="line">              &#x2F;&#x2F; 不同点：此时是reject</span><br><span class="line">              result instanceof Promise ? result.then(resolve, reject) : reject(result);</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; catch(e) &#123;</span><br><span class="line">            reject(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; else if (self.status &#x3D;&#x3D;&#x3D; FULFILLED) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">          setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">            const result &#x3D; onFulfilled(self.value);</span><br><span class="line">            result instanceof Promise ? result.then(resolve, reject) : resolve(result);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; catch(e) &#123;</span><br><span class="line">          reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else if (self.status &#x3D;&#x3D;&#x3D; REJECTED) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">          setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">            const result &#x3D; onRejected(self.reason);</span><br><span class="line">            result instanceof Promise ? result.then(resolve, reject) : resolve(result);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; catch(e) &#123;</span><br><span class="line">          reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  catch(onRejected) &#123;</span><br><span class="line">    return this.then(null, onRejected);</span><br><span class="line">  &#125;</span><br><span class="line">  static resolve(value) &#123;</span><br><span class="line">    if (value instanceof Promise) &#123;</span><br><span class="line">      &#x2F;&#x2F; 如果是Promise实例，直接返回</span><br><span class="line">      return value;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      &#x2F;&#x2F; 如果不是Promise实例，返回一个新的Promise对象，状态为FULFILLED</span><br><span class="line">      return new Promise((resolve, reject) &#x3D;&gt; resolve(value));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  static reject(reason) &#123;</span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">      reject(reason);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  static all(promiseArr) &#123;</span><br><span class="line">    const len &#x3D; promiseArr.length;</span><br><span class="line">    const values &#x3D; new Array(len);</span><br><span class="line">    &#x2F;&#x2F; 记录已经成功执行的promise个数</span><br><span class="line">    let count &#x3D; 0;</span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">      for (let i &#x3D; 0; i &lt; len; i++) &#123;</span><br><span class="line">        &#x2F;&#x2F; Promise.resolve()处理，确保每一个都是promise实例</span><br><span class="line">        Promise.resolve(promiseArr[i]).then(</span><br><span class="line">          val &#x3D;&gt; &#123;</span><br><span class="line">            values[i] &#x3D; val;</span><br><span class="line">            count++;</span><br><span class="line">            &#x2F;&#x2F; 如果全部执行完，返回promise的状态就可以改变了</span><br><span class="line">            if (count &#x3D;&#x3D;&#x3D; len) resolve(values);</span><br><span class="line">          &#125;,</span><br><span class="line">          err &#x3D;&gt; reject(err),</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  static race(promiseArr) &#123;</span><br><span class="line">    return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">      promiseArr.forEach(p &#x3D;&gt; &#123;</span><br><span class="line">        Promise.resolve(p).then(</span><br><span class="line">          val &#x3D;&gt; resolve(val),</span><br><span class="line">          err &#x3D;&gt; reject(err),</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、Promise并行限制"><a href="#三、Promise并行限制" class="headerlink" title="三、Promise并行限制"></a>三、Promise并行限制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class Scheduler &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.queue &#x3D; [];</span><br><span class="line">    this.maxCount &#x3D; 2;</span><br><span class="line">    this.runCounts &#x3D; 0;</span><br><span class="line">  &#125;</span><br><span class="line">  add(promiseCreator) &#123;</span><br><span class="line">    this.queue.push(promiseCreator);</span><br><span class="line">  &#125;</span><br><span class="line">  taskStart() &#123;</span><br><span class="line">    for (let i &#x3D; 0; i &lt; this.maxCount; i++) &#123;</span><br><span class="line">      this.request();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  request() &#123;</span><br><span class="line">    if (!this.queue || !this.queue.length || this.runCounts &gt;&#x3D; this.maxCount) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    this.runCounts++;</span><br><span class="line"></span><br><span class="line">    this.queue.shift()().then(() &#x3D;&gt; &#123;</span><br><span class="line">      this.runCounts--;</span><br><span class="line">      this.request();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const timeout &#x3D; time &#x3D;&gt; new Promise(resolve &#x3D;&gt; &#123;</span><br><span class="line">  setTimeout(resolve, time);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const scheduler &#x3D; new Scheduler();</span><br><span class="line"></span><br><span class="line">const addTask &#x3D; (time,order) &#x3D;&gt; &#123;</span><br><span class="line">  scheduler.add(() &#x3D;&gt; timeout(time).then(()&#x3D;&gt;console.log(order)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addTask(1000, &#39;1&#39;);</span><br><span class="line">addTask(500, &#39;2&#39;);</span><br><span class="line">addTask(300, &#39;3&#39;);</span><br><span class="line">addTask(400, &#39;4&#39;);</span><br><span class="line">scheduler.taskStart()</span><br><span class="line">&#x2F;&#x2F; 2</span><br><span class="line">&#x2F;&#x2F; 3</span><br><span class="line">&#x2F;&#x2F; 1</span><br><span class="line">&#x2F;&#x2F; 4</span><br></pre></td></tr></table></figure><h2 id="四、JSONP的实现"><a href="#四、JSONP的实现" class="headerlink" title="四、JSONP的实现"></a>四、JSONP的实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const jsonp &#x3D; (&#123; url, params, callbackName &#125;) &#x3D;&gt; &#123;</span><br><span class="line">  const generateUrl &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    let dataSrc &#x3D; &#39;&#39;;</span><br><span class="line">    for (let key in params) &#123;</span><br><span class="line">      if (Object.prototype.hasOwnProperty.call(params, key)) &#123;</span><br><span class="line">        dataSrc +&#x3D; &#96;$&#123;key&#125;&#x3D;$&#123;params[key]&#125;&amp;&#96;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dataSrc +&#x3D; &#96;callback&#x3D;$&#123;callbackName&#125;&#96;;</span><br><span class="line">    return &#96;$&#123;url&#125;?$&#123;dataSrc&#125;&#96;;</span><br><span class="line">  &#125;</span><br><span class="line">  return new Promise((resolve, reject) &#x3D;&gt; &#123;</span><br><span class="line">    const scriptEle &#x3D; document.createElement(&#39;script&#39;);</span><br><span class="line">    scriptEle.src &#x3D; generateUrl();</span><br><span class="line">    document.body.appendChild(scriptEle);</span><br><span class="line">    window[callbackName] &#x3D; data &#x3D;&gt; &#123;</span><br><span class="line">      resolve(data);</span><br><span class="line">      document.removeChild(scriptEle);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五、event模块实现"><a href="#五、event模块实现" class="headerlink" title="五、event模块实现"></a>五、event模块实现</h2><p>实现node中回调函数的机制，node中回调函数其实是内部使用了观察者模式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">function EventEmitter() &#123;</span><br><span class="line">  this.events &#x3D; new Map();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 需要实现的一些方法：</span><br><span class="line">&#x2F;&#x2F; addListener、removeListener、once、removeAllListeners、emit</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 模拟实现addlistener方法</span><br><span class="line">const wrapCallback &#x3D; (fn, once &#x3D; false) &#x3D;&gt; (&#123; callback: fn, once &#125;);</span><br><span class="line">EventEmitter.prototype.addListener &#x3D; function(type, fn, once &#x3D; false) &#123;</span><br><span class="line">  const hanlder &#x3D; this.events.get(type);</span><br><span class="line">  if (!hanlder) &#123;</span><br><span class="line">    &#x2F;&#x2F; 没有type绑定事件</span><br><span class="line">    this.events.set(type, wrapCallback(fn, once));</span><br><span class="line">  &#125; else if (hanlder &amp;&amp; typeof hanlder.callback &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;</span><br><span class="line">    &#x2F;&#x2F; 目前type事件只有一个回调</span><br><span class="line">    this.events.set(type, [hanlder, wrapCallback(fn, once)]);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F; 目前type事件数&gt;&#x3D;2</span><br><span class="line">    hanlder.push(wrapCallback(fn, once));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 模拟实现removeListener</span><br><span class="line">EventEmitter.prototype.removeListener &#x3D; function(type, listener) &#123;</span><br><span class="line">  const hanlder &#x3D; this.events.get(type);</span><br><span class="line">  if (!hanlder) return;</span><br><span class="line">  if (!Array.isArray(this.events)) &#123;</span><br><span class="line">    if (hanlder.callback &#x3D;&#x3D;&#x3D; listener.callback) this.events.delete(type);</span><br><span class="line">    else return;</span><br><span class="line">  &#125;</span><br><span class="line">  for (let i &#x3D; 0; i &lt; hanlder.length; i++) &#123;</span><br><span class="line">    const item &#x3D; hanlder[i];</span><br><span class="line">    if (item.callback &#x3D;&#x3D;&#x3D; listener.callback) &#123;</span><br><span class="line">      hanlder.splice(i, 1);</span><br><span class="line">      i--;</span><br><span class="line">      if (hanlder.length &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">        this.events.set(type, hanlder[0]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 模拟实现once方法</span><br><span class="line">EventEmitter.prototype.once &#x3D; function(type, listener) &#123;</span><br><span class="line">  this.addListener(type, listener, true);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 模拟实现emit方法</span><br><span class="line">EventEmitter.prototype.emit &#x3D; function(type, ...args) &#123;</span><br><span class="line">  const hanlder &#x3D; this.events.get(type);</span><br><span class="line">  if (!hanlder) return;</span><br><span class="line">  if (Array.isArray(hanlder)) &#123;</span><br><span class="line">    hanlder.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">      item.callback.apply(this, args);</span><br><span class="line">      if (item.once) &#123;</span><br><span class="line">        this.removeListener(type, item);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    hanlder.callback.apply(this, args);</span><br><span class="line">    if (hanlder.once) &#123;</span><br><span class="line">      this.events.delete(type);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return true;</span><br><span class="line">&#125;</span><br><span class="line">EventEmitter.prototype.removeAllListeners &#x3D; function(type) &#123;</span><br><span class="line">  const hanlder &#x3D; this.events.get(type);</span><br><span class="line">  if (!hanlder) return;</span><br><span class="line">  this.events.delete(type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="六、一次性渲染几万条数据数据，页面不算很卡的方法"><a href="#六、一次性渲染几万条数据数据，页面不算很卡的方法" class="headerlink" title="六、一次性渲染几万条数据数据，页面不算很卡的方法"></a>六、一次性渲染几万条数据数据，页面不算很卡的方法</h2><p>几万条数据，假如不是滚动加载，一次性渲染到页面中，单单是节点，都会很慢。下面方法可以渲染出来。但是节点很多，也会比较慢，但是是一次性渲染几万条数据比较好的方式了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; 插入十万条数据</span><br><span class="line">  const total &#x3D; 100000;</span><br><span class="line">  &#x2F;&#x2F; 一次插入的数据</span><br><span class="line">  const once &#x3D; 20;</span><br><span class="line">  &#x2F;&#x2F; 插入数据需要的次数</span><br><span class="line">  const loopCount &#x3D; Math.ceil(total &#x2F; once);</span><br><span class="line">  let countOfRender &#x3D; 0;</span><br><span class="line">  const ul &#x3D; document.querySelector(&#39;ul&#39;);</span><br><span class="line">  &#x2F;&#x2F; 添加数据的方法</span><br><span class="line">  function add() &#123;</span><br><span class="line">    const fragment &#x3D; document.createDocumentFragment();</span><br><span class="line">    for(let i &#x3D; 0; i &lt; once; i++) &#123;</span><br><span class="line">      const li &#x3D; document.createElement(&#39;li&#39;);</span><br><span class="line">      li.innerText &#x3D; Math.floor(Math.random() * total);</span><br><span class="line">      fragment.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">    ul.appendChild(fragment);</span><br><span class="line">    countOfRender +&#x3D; 1;</span><br><span class="line">    loop();</span><br><span class="line">  &#125;</span><br><span class="line">  function loop() &#123;</span><br><span class="line">    if(countOfRender &lt; loopCount) &#123;</span><br><span class="line">      window.requestAnimationFrame(add);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  loop();</span><br><span class="line">&#125;, 0)</span><br></pre></td></tr></table></figure><p>这个方法使用createDocumentFragment和requestAnimationFrame，将操作切分为一小段一小段执行。</p><h2 id="七、将VirtualDom转化为真实DOM结构"><a href="#七、将VirtualDom转化为真实DOM结构" class="headerlink" title="七、将VirtualDom转化为真实DOM结构"></a>七、将VirtualDom转化为真实DOM结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; vnode结构：</span><br><span class="line">&#x2F;&#x2F; &#123;</span><br><span class="line">&#x2F;&#x2F;   tag,</span><br><span class="line">&#x2F;&#x2F;   attrs,</span><br><span class="line">&#x2F;&#x2F;   children,</span><br><span class="line">&#x2F;&#x2F; &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Virtual DOM &#x3D;&gt; DOM</span><br><span class="line">function render(vnode, container) &#123;</span><br><span class="line">  container.appendChild(_render(vnode));</span><br><span class="line">&#125;</span><br><span class="line">function _render(vnode) &#123;</span><br><span class="line">  &#x2F;&#x2F; 如果是数字类型转化为字符串</span><br><span class="line">  if (typeof vnode &#x3D;&#x3D;&#x3D; &#39;number&#39;) &#123;</span><br><span class="line">    vnode &#x3D; String(vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; 字符串类型直接就是文本节点</span><br><span class="line">  if (typeof vnode &#x3D;&#x3D;&#x3D; &#39;string&#39;) &#123;</span><br><span class="line">    return document.createTextNode(vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; 普通DOM</span><br><span class="line">  const dom &#x3D; document.createElement(vnode.tag);</span><br><span class="line">  if (vnode.attrs) &#123;</span><br><span class="line">    &#x2F;&#x2F; 遍历属性</span><br><span class="line">    Object.keys(vnode.attrs).forEach(key &#x3D;&gt; &#123;</span><br><span class="line">      const value &#x3D; vnode.attrs[key];</span><br><span class="line">      dom.setAttribute(key, value);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; 子数组进行递归操作</span><br><span class="line">  vnode.children.forEach(child &#x3D;&gt; render(child, dom));</span><br><span class="line">  return dom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="八、字符串解析问题"><a href="#八、字符串解析问题" class="headerlink" title="八、字符串解析问题"></a>八、字符串解析问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a &#x3D; &#123;</span><br><span class="line">    b: 123,</span><br><span class="line">    c: &#39;456&#39;,</span><br><span class="line">    e: &#39;789&#39;,</span><br><span class="line">&#125;</span><br><span class="line">var str&#x3D;&#96;a&#123;a.b&#125;aa&#123;a.c&#125;aa &#123;a.d&#125;aaaa&#96;;</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; &#39;a123aa456aa &#123;a.d&#125;aaaa&#39;</span><br></pre></td></tr></table></figure><p>实现函数使得将str字符串中的{}内的变量替换，如果属性不存在保持原样（比如{a.d}） 类似于模版字符串，但有一点出入，实际上原理大差不差</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">const fn1 &#x3D; (str, obj) &#x3D;&gt; &#123;</span><br><span class="line">    let res &#x3D; &#39;&#39;;</span><br><span class="line">    &#x2F;&#x2F; 标志位，标志前面是否有&#123;</span><br><span class="line">    let flag &#x3D; false;</span><br><span class="line">    let start;</span><br><span class="line">    for (let i &#x3D; 0; i &lt; str.length; i++) &#123;</span><br><span class="line">        if (str[i] &#x3D;&#x3D;&#x3D; &#39;&#123;&#39;) &#123;</span><br><span class="line">            flag &#x3D; true;</span><br><span class="line">            start &#x3D; i + 1;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!flag) res +&#x3D; str[i];</span><br><span class="line">        else &#123;</span><br><span class="line">            if (str[i] &#x3D;&#x3D;&#x3D; &#39;&#125;&#39;) &#123;</span><br><span class="line">                flag &#x3D; false;</span><br><span class="line">                res +&#x3D; match(str.slice(start, i), obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 对象匹配操作</span><br><span class="line">const match &#x3D; (str, obj) &#x3D;&gt; &#123;</span><br><span class="line">    const keys &#x3D; str.split(&#39;.&#39;).slice(1);</span><br><span class="line">    let index &#x3D; 0;</span><br><span class="line">    let o &#x3D; obj;</span><br><span class="line">    while (index &lt; keys.length) &#123;</span><br><span class="line">        const key &#x3D; keys[index];</span><br><span class="line">        if (!o[key]) &#123;</span><br><span class="line">            return &#96;&#123;$&#123;str&#125;&#125;&#96;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            o &#x3D; o[key];</span><br><span class="line">        &#125;</span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line">    return o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="九、数组扁平化"><a href="#九、数组扁平化" class="headerlink" title="九、数组扁平化"></a>九、数组扁平化</h2><p>数组扁平化是指将一个多维数组变为一个一维数组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const arr &#x3D; [1, [2, [3, [4, 5]]], 6];</span><br><span class="line">&#x2F;&#x2F; &#x3D;&gt; [1, 2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure><p>方法一：使用flat()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const res1 &#x3D; arr.flat(Infinity);</span><br></pre></td></tr></table></figure><p>方法二：正则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const res3 &#x3D; JSON.parse(&#39;[&#39; + JSON.stringify(arr).replace(&#x2F;\[|\]&#x2F;g, &#39;&#39;) + &#39;]&#39;);</span><br></pre></td></tr></table></figure><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>table-cell绝对是一个现代的布局神器</title>
      <link href="2021/01/07/%E5%B8%83%E5%B1%80%E7%A5%9E%E5%99%A8----displaytable-cell/"/>
      <url>2021/01/07/%E5%B8%83%E5%B1%80%E7%A5%9E%E5%99%A8----displaytable-cell/</url>
      
        <content type="html"><![CDATA[<p>##用float来做布局触发的问题比较多，例如要清除浮动，元素浮动后还会导致该元素脱离文档流，即使你清除float，该元素依旧是脱离文档流。**</p><p>左右布局能用<code>display:inline-block;</code>布局我就用它来布局，但是还是无法完全不使用它，很多布局例如需要靠左和靠右的布局场景下就没办法不去使用float来布局。</p><h2 id="元素两端对齐"><a href="#元素两端对齐" class="headerlink" title="元素两端对齐"></a>元素两端对齐</h2><p>第一个案例是让两个元素分别向左和向右对齐，如果是过去，我一定会用float来实现，但其实用table可以这么做：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57bfff8e9c83e.png" alt="img"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">          *&#123;</span><br><span class="line"><span class="css">              <span class="selector-tag">box-sizing</span><span class="selector-pseudo">:border-box</span>;</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">          <span class="selector-class">.content</span>&#123;</span></span><br><span class="line">              display: table;</span><br><span class="line"><span class="css">              <span class="selector-tag">border</span><span class="selector-pseudo">:1px</span> <span class="selector-tag">solid</span> <span class="selector-id">#06c</span>;</span></span><br><span class="line"><span class="css">              <span class="selector-tag">padding</span><span class="selector-pseudo">:15px</span> 15<span class="selector-tag">px</span>;</span></span><br><span class="line">              max-width: 1000px;</span><br><span class="line"><span class="css">              <span class="selector-tag">margin</span><span class="selector-pseudo">:10px</span> <span class="selector-tag">auto</span>;</span></span><br><span class="line">              min-width: 320px;</span><br><span class="line"><span class="css">              <span class="selector-tag">width</span><span class="selector-pseudo">:100</span>%;</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">          <span class="selector-class">.box</span>&#123;</span></span><br><span class="line"><span class="css">              <span class="selector-tag">width</span><span class="selector-pseudo">:100px</span>;</span></span><br><span class="line"><span class="css">              <span class="selector-tag">height</span><span class="selector-pseudo">:100px</span>;</span></span><br><span class="line"><span class="css">              <span class="selector-tag">border</span><span class="selector-pseudo">:1px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ccc</span>;</span></span><br><span class="line">              text-align: center;</span><br><span class="line">              display: inline-block;</span><br><span class="line">              font-size: 40px;</span><br><span class="line">              line-height: 100px;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.right</span>&#123;</span></span><br><span class="line">              text-align: right;</span><br><span class="line">              display: table-cell;</span><br><span class="line">          &#125;</span><br><span class="line"><span class="css">         <span class="selector-class">.left</span>&#123;</span></span><br><span class="line">              text-align: left;</span><br><span class="line">              display: table-cell;</span><br><span class="line">          &#125;     </span><br><span class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="自动平均划分每个小模块，使其一行显示"><a href="#自动平均划分每个小模块，使其一行显示" class="headerlink" title="自动平均划分每个小模块，使其一行显示"></a>自动平均划分每个小模块，使其一行显示</h2><p>第二个案例我们先看看图：</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57c002f096392.png" alt="img"></p><p>遇到上面这种布局，一般会用<code>float</code>来做，或者把每个<code>li</code>设置成<code>display:inline-block;</code>来做，并且都要设置给他们设置一个宽度，而且最痛苦的是5个<code>li</code>如果你设置<code>width:20%;</code>他们一定会掉下来，如果<code>li</code>都设置成<code>display:table-cell；</code>就不会出现这种情况，即使不设置宽度他们也会在一行显示，你在加多一行他也不会掉下来，依旧会在一样显示。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">   &lt;title&gt;&lt;/title&gt;</span><br><span class="line">   &lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">         *&#123;</span><br><span class="line">           box-sizing:border-box;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">         .content&#123;</span><br><span class="line">             display: table;</span><br><span class="line">             border:1px solid <span class="comment">#06c;</span></span><br><span class="line">             padding:15px 15px;</span><br><span class="line">             max-width: 1000px;</span><br><span class="line">             margin:10px auto;</span><br><span class="line">             min-width:320px;</span><br><span class="line">             width:100%;</span><br><span class="line">         &#125;</span><br><span class="line">        .content ul&#123;</span><br><span class="line">             display: table;</span><br><span class="line">             width:100%;</span><br><span class="line">             padding:0;</span><br><span class="line">             border-right:1px solid <span class="comment">#ccc;</span></span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        .content ul li&#123;</span><br><span class="line">            display: table-cell;</span><br><span class="line">            border:1px solid <span class="comment">#ccc;</span></span><br><span class="line">            text-align: center;</span><br><span class="line">            height:100px;</span><br><span class="line">            border-right: none;</span><br><span class="line">            line-height: 100px;</span><br><span class="line">         &#125;</span><br><span class="line">   &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">   &lt;div class=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">       &lt;ul&gt;</span><br><span class="line">         &lt;li&gt;1&lt;/li&gt;</span><br><span class="line">         &lt;li&gt;2&lt;/li&gt;</span><br><span class="line">         &lt;li&gt;3&lt;/li&gt;</span><br><span class="line">         &lt;li&gt;4&lt;/li&gt;</span><br><span class="line">         &lt;li&gt;5&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="图片垂直居中于元素"><a href="#图片垂直居中于元素" class="headerlink" title="图片垂直居中于元素"></a>图片垂直居中于元素</h2><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57c00719bf4c5.png" alt="img"></p><p>有时候我们需要让图片垂直水平都居中于某个元素，用常规写法比较复杂，但用table-cell则相对简单：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">       &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">       &lt;title&gt;&lt;/title&gt;</span><br><span class="line">       &lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">        *&#123;</span><br><span class="line">            box-sizing:border-box;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        .content&#123;</span><br><span class="line">            display: table;</span><br><span class="line">            border:1px solid <span class="comment">#06c;</span></span><br><span class="line">            padding:15px 15px;</span><br><span class="line">            max-width: 1000px;</span><br><span class="line">            margin:10px auto;</span><br><span class="line">            min-width:320px;</span><br><span class="line">            width:100%;</span><br><span class="line">         &#125;</span><br><span class="line">        .img-box&#123;</span><br><span class="line">            height:150px;</span><br><span class="line">            width:100px;</span><br><span class="line">            border:1px solid red;</span><br><span class="line">            display: table-cell;</span><br><span class="line">            vertical-align: middle;</span><br><span class="line">            text-align: center;</span><br><span class="line">            background-color: <span class="comment">#4679bd;</span></span><br><span class="line">        &#125;</span><br><span class="line">       &lt;/style&gt;</span><br><span class="line"> &lt;/head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">      &lt;div class=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;img-box&quot;</span>&gt;</span><br><span class="line">               ![logo](http://upload-images.jianshu.io/upload_images/1432546-53d1c7f44dc6e873.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;  </span><br><span class="line"> &lt;/body&gt;</span><br><span class="line"> &lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="两box实现等高对齐"><a href="#两box实现等高对齐" class="headerlink" title="两box实现等高对齐"></a>两box实现等高对齐</h2><p>上图中的左侧的box的高度始终跟随右侧的box的高度变化而变化</p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57c00c4b0e43b.png" alt="img"></p><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57c00c820ac9f.png" alt="img"></p><p>上面的案例我故意不对右侧的box设置<code>display:table-cell</code>，只对左侧，所以就会出现左侧跟随右侧高度变化而变化，如果要实现不管两个box哪个高度产生变化另一个就跟随，只需要把右侧的box也设置成<code>display:table－cell</code>就可以实现了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">     &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">     &lt;title&gt;&lt;/title&gt;</span><br><span class="line">     &lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">       *&#123;</span><br><span class="line">           box-sizing:border-box;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .content&#123;</span><br><span class="line">           display: table;</span><br><span class="line">           border:1px solid <span class="comment">#06c;</span></span><br><span class="line">           padding:15px 15px;</span><br><span class="line">           max-width: 1000px;</span><br><span class="line">           margin:10px auto;</span><br><span class="line">           min-width:320px;</span><br><span class="line">           width:100%;</span><br><span class="line">        &#125;</span><br><span class="line">        .img-box&#123;</span><br><span class="line">           height:150px;</span><br><span class="line">           width:100px;</span><br><span class="line">           border:1px solid red;</span><br><span class="line">           display: table-cell;</span><br><span class="line">           vertical-align: middle;</span><br><span class="line">           text-align: center;</span><br><span class="line">           background-color: <span class="comment">#4679bd;</span></span><br><span class="line">        &#125;</span><br><span class="line">        .text-box&#123;</span><br><span class="line">           margin-left: 20px;</span><br><span class="line">           border:1px solid <span class="comment">#ddd;</span></span><br><span class="line">           padding:10px;</span><br><span class="line">        &#125;</span><br><span class="line">     &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">       &lt;div class=<span class="string">&quot;img-box&quot;</span>&gt;</span><br><span class="line">          ![logo](http://upload-images.jianshu.io/upload_images/1432546-53d1c7f44dc6e873.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">       &lt;div class=<span class="string">&quot;text-box&quot;</span>&gt;</span><br><span class="line">          &lt;span&gt;</span><br><span class="line">              王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">     &lt;/div&gt; </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="弹性、响应式布局"><a href="#弹性、响应式布局" class="headerlink" title="弹性、响应式布局"></a>弹性、响应式布局</h2><p><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://ooo.0o0.ooo/2016/08/26/57c00fca9d805.gif" alt="img"></p></img><p>上面的demo中大家只要改变浏览器宽度就会发现他们其实都是会随高度变化自动变化高度的，其实上面内容我大部分没有设置绝对单位，即使设置了也只设置其中一个box另一个就让他去自适应父元素的剩余留下来的宽度，其实布局的时候设置宽度是一件很痛苦的事情，因为除了大量计算有时候可能在多浏览器下还算不准，可能你在chrome设好的宽度在ie下就坑爹了，要写hack才能解决。最后一个案例，据不靠谱的传言faceboox曾经也这么使用过：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">   &lt;title&gt;&lt;/title&gt;</span><br><span class="line">   &lt;style <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><br><span class="line">      *&#123;</span><br><span class="line">        box-sizing:border-box;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      .content&#123;</span><br><span class="line">         display: table;</span><br><span class="line">         border:1px solid <span class="comment">#06c;</span></span><br><span class="line">         padding:15px 15px;</span><br><span class="line">         max-width: 1000px;</span><br><span class="line">         margin:10px auto;</span><br><span class="line">         min-width:320px;</span><br><span class="line">         width:100%;</span><br><span class="line">      &#125;</span><br><span class="line">      .left-box&#123;</span><br><span class="line">         <span class="built_in">float</span>:left;</span><br><span class="line">         margin-right: 10px;</span><br><span class="line">         padding-top: 5px;</span><br><span class="line">      &#125;</span><br><span class="line">      .right-box&#123;</span><br><span class="line">         display: table-cell;</span><br><span class="line">         padding:10px;</span><br><span class="line">         border:1px solid <span class="comment">#ccc;</span></span><br><span class="line">         margin-right: 10px;</span><br><span class="line">         vertical-align: top;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">     &lt;div class=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">          &lt;div class=<span class="string">&quot;img-box&quot;</span>&gt;</span><br><span class="line">            ![logo](http://upload-images.jianshu.io/upload_images/1432546-53d1c7f44dc6e873.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=<span class="string">&quot;right-box&quot;</span>&gt;</span><br><span class="line">             &lt;span&gt;王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。王尼玛和陈尼玛都是年轻有为的骚年，有一天他们相遇了，然后发现都对对方一见钟情后，所以就愉快的生活在了一起。。。。。&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;    </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>移动端布局因为有display:box这等属性，所以table-cell相对就排不上什么大用场，不过在移动端你要用table-cell也不是不可以，根据自己对属性的理解去使用就可以了。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise入门</title>
      <link href="2021/01/05/Promise%E5%85%A5%E9%97%A8%E8%AF%A6%E8%A7%A3/"/>
      <url>2021/01/05/Promise%E5%85%A5%E9%97%A8%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="异步调用"><a href="#异步调用" class="headerlink" title="异步调用"></a>异步调用</h2><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p>JavaScript 的执行环境是<strong>单线程</strong>。</p><p>所谓单线程，是指 JS 引擎中负责解释和执行 JavaScript 代码的线程只有一个，也就是一次只能完成一项任务，这个任务执行完后才能执行下一个，它会「阻塞」其他任务。这个任务可称为主线程。</p><p>异步模式可以一起执行<strong>多个任务</strong>。</p><p>常见的异步模式有以下几种：</p><ul><li><p>定时器</p></li><li><p>接口调用</p></li><li><p>事件函数</p></li></ul><p>今天这篇文章，我们重点讲一下<strong>接口调用</strong>。接口调用里，重点讲一下<strong>Promise</strong>。</p><h3 id="接口调用的方式"><a href="#接口调用的方式" class="headerlink" title="接口调用的方式"></a>接口调用的方式</h3><p>js 中常见的接口调用方式，有以下几种：</p><ul><li>原生 ajax</li><li>基于 jQuery 的 ajax</li><li>Fetch</li><li>Promise</li><li>axios</li></ul><h3 id="多次异步调用的依赖分析"><a href="#多次异步调用的依赖分析" class="headerlink" title="多次异步调用的依赖分析"></a>多次异步调用的依赖分析</h3><ul><li><p>多次异步调用的结果，顺序可能不同步。</p></li><li><p>异步调用的结果如果<strong>存在依赖</strong>，则需要嵌套。</p></li></ul><p>在 ES5 中，当进行多层嵌套回调时，会导致代码层次过多，很难进行维护和二次开发；而且会导致<strong>回调地狱</strong>的问题。ES6 中的 Promise 就可以解决这两个问题。</p><h2 id="Promise-概述"><a href="#Promise-概述" class="headerlink" title="Promise 概述"></a>Promise 概述</h2><h3 id="Promise-的介绍和优点"><a href="#Promise-的介绍和优点" class="headerlink" title="Promise 的介绍和优点"></a>Promise 的介绍和优点</h3><p>ES6 中的 Promise 是异步编程的一种方案。从语法上讲，Promise 是一个对象，它可以获取异步操作的消息。</p><p>Promise 对象, 可以<strong>用同步的表现形式来书写异步代码</strong>（也就是说，代码看起来是同步的，但本质上的运行过程是异步的）。使用 Promise 主要有以下好处：</p><ul><li><p>可以很好地解决<strong>回调地狱</strong>的问题（避免了层层嵌套的回调函数）。</p></li><li><p>语法非常简洁、可读性强。Promise 对象提供了简洁的 API，使得控制异步操作更加容易。</p></li></ul><h3 id="回调地狱的举例"><a href="#回调地狱的举例" class="headerlink" title="回调地狱的举例"></a>回调地狱的举例</h3><p>假设买菜、做饭、洗碗、倒厨余垃圾都是异步的。</p><p>但真实的场景中，实际的操作流程是：买菜成功之后，才能开始做饭。做饭成功后，才能开始洗碗。洗碗结束后， 再倒厨余垃圾。这里的一系列动作就涉及到了多层嵌套调用，也就是回调地狱。</p><h2 id="Promise-的基本用法"><a href="#Promise-的基本用法" class="headerlink" title="Promise 的基本用法"></a>Promise 的基本用法</h2><p>（1）使用 new 实例化一个 Promise 对象，Promise 的构造函数中传递一个参数。这个参数是一个函数，该函数用于处理异步任务。</p><p>（2）并且传入两个参数：resolve 和 reject，分别表示异步执行成功后的回调函数和异步执行失败后的回调函数；</p><p>（3）通过 promise.then() 处理返回结果。这里的 <code>promise</code> 指的是 Promise 实例。</p><h3 id="Promise-处理异步任务"><a href="#Promise-处理异步任务" class="headerlink" title="Promise 处理异步任务"></a>Promise 处理异步任务</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 第一步：model层的接口封装</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 这里做异步任务（比如ajax 请求接口。这里暂时用定时器代替）</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> data = &#123; <span class="attr">retCode</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;qianguyihao&#x27;</span> &#125;; <span class="comment">// 接口返回的数据</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (data.retCode == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 接口请求成功时调用</span></span></span><br><span class="line">            resolve(data);</span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 接口请求失败时调用</span></span></span><br><span class="line"><span class="javascript">            reject(&#123; <span class="attr">retCode</span>: -<span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;network error&#x27;</span> &#125;);</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, 100);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 第二步：业务层的接口调用。这里的 data 就是 从 resolve 和 reject 传过来的，也就是从接口拿到的数据</span></span></span><br><span class="line">      promise</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 从 resolve 获取正常结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .catch(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 从 reject 获取异常结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上方代码中，当从接口返回的数据<code>data.retCode</code>的值不同时，可能会走 resolve，也可能会走 reject，这个由你自己的业务决定。</p><h3 id="Promise-封装-Ajax-请求"><a href="#Promise-封装-Ajax-请求" class="headerlink" title="Promise 封装 Ajax 请求"></a>Promise 封装 Ajax 请求</h3><p>写法1：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise 封装接口</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        request(<span class="string">&#x27;https://www.baidu.com&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (response.retCode == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="comment">// 这里的 response 是接口1的返回结果</span></span><br><span class="line">                resolve(<span class="string">&#x27;request1 success&#x27;</span> + response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request1().then(<span class="function">(<span class="params">res1</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接口1请求成功后，打印接口1的返回结果</span></span><br><span class="line">    <span class="built_in">console</span>.log(res1);</span><br><span class="line">    <span class="keyword">return</span> request2();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>写法2：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise 封装接口1</span></span><br><span class="line"><span class="keyword">const</span> request1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        request(<span class="string">&#x27;https://www.baidu.com&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (response.retCode == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="comment">// 这里的 response 是接口1的返回结果</span></span><br><span class="line">                resolve(<span class="string">&#x27;request1 success&#x27;</span> + response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先发起request1，等resolve后再发起request2；紧接着，等 request2有了 resolve之后，再发起 request3</span></span><br><span class="line">request1().then(<span class="function">(<span class="params">res1</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 接口1请求成功后，打印接口1的返回结果</span></span><br><span class="line">    <span class="built_in">console</span>.log(res1);</span><br><span class="line">    <span class="keyword">return</span> request2();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="promise-对象的-3-个状态（了解即可）"><a href="#promise-对象的-3-个状态（了解即可）" class="headerlink" title="promise 对象的 3 个状态（了解即可）"></a>promise 对象的 3 个状态（了解即可）</h2><ul><li><p>初始化状态（等待状态）：pending</p></li><li><p>成功状态：fulfilled</p></li><li><p>失败状态：rejected</p></li></ul><p>（1）当 new Promise()执行之后，promise 对象的状态会被初始化为<code>pending</code>，这个状态是初始化状态。<code>new Promise()</code>这行代码，括号里的内容是同步执行的。括号里定义一个 function，function 有两个参数：resolve 和 reject。如下：</p><ul><li><p>如果请求成功了，则执行 resolve()，此时，promise 的状态会被自动修改为 fulfilled。</p></li><li><p>如果请求失败了，则执行 reject()，此时，promise 的状态会被自动修改为 rejected</p></li></ul><p>（2）promise.then()方法，括号里面有两个参数，分别代表两个函数 function1 和 function2：</p><ul><li><p>如果 promise 的状态为 fulfilled（意思是：如果请求成功），则执行 function1 里的内容</p></li><li><p>如果 promise 的状态为 rejected（意思是，如果请求失败），则执行 function2 里的内容</p></li></ul><p>另外，resolve()和 reject()这两个方法，是可以给 promise.then()传递参数的。</p><p>完整代码举例如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//进来之后，状态为pending</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;111&#x27;</span>); <span class="comment">//这行代码是同步的</span></span><br><span class="line">  <span class="comment">//开始执行异步操作（这里开始，写异步的代码，比如ajax请求 or 开启定时器）</span></span><br><span class="line">  <span class="keyword">if</span> (异步的ajax请求成功) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;333&#x27;</span>);</span><br><span class="line">    resolve(<span class="string">&#x27;haha&#x27;</span>); <span class="comment">//如果请求成功了，请写resolve()，此时，promise的状态会被自动修改为fulfilled</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(<span class="string">&#x27;555&#x27;</span>); <span class="comment">//如果请求失败了，请写reject()，此时，promise的状态会被自动修改为rejected</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;222&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用promise的then()</span></span><br><span class="line">promise.then(</span><br><span class="line">  (successMsg) =&gt; &#123;</span><br><span class="line">    <span class="comment">//如果promise的状态为fulfilled，则执行这里的代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(successMsg, <span class="string">&#x27;成功了&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  (errorMsg) =&gt; &#123;</span><br><span class="line">    <span class="comment">//如果promise的状态为rejected，则执行这里的代码</span></span><br><span class="line">    <span class="built_in">console</span>.log(errorMsg, <span class="string">&#x27;失败了&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="基于-Promise-处理多次-Ajax-请求（链式调用）【重要】"><a href="#基于-Promise-处理多次-Ajax-请求（链式调用）【重要】" class="headerlink" title="基于 Promise 处理多次 Ajax 请求（链式调用）【重要】"></a>基于 Promise 处理多次 Ajax 请求（链式调用）【重要】</h2><p>实际开发中，我们经常需要同时请求多个接口。比如说：在请求完<code>接口1</code>的数据<code>data1</code>之后，需要根据<code>data1</code>的数据，继续请求接口 2，获取<code>data2</code>；然后根据<code>data2</code>的数据，继续请求接口 3。</p><p>换而言之，现在有三个网络请求，请求 2 必须依赖请求 1 的结果，请求 3 必须依赖请求 2 的结果，如果按照往常的写法，会有三层回调，会陷入“回调地狱”。</p><p>这种场景其实就是接口的多层嵌套调用。有了 Promise 之后，我们可以把多层嵌套调用按照<strong>线性</strong>的方式进行书写，非常优雅。也就是说：Promise 可以把原本的<strong>多层嵌套调用</strong>改进为<strong>链式调用</strong>。</p><p>代码举例：（多次 Ajax 请求，链式调用）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// Promise 封装接口1</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> request1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          request(<span class="string">&#x27;https://www.baidu.com&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (response.retCode == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 这里的 response 是接口1的返回结果</span></span></span><br><span class="line"><span class="javascript">              resolve(<span class="string">&#x27;request1 success&#x27;</span> + response);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> promise;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// Promise 封装接口2</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> request2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          request(<span class="string">&#x27;https://www.jd.com&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (response.retCode == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 这里的 response 是接口2的返回结果</span></span></span><br><span class="line"><span class="javascript">              resolve(<span class="string">&#x27;request2 success&#x27;</span> + response);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> promise;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// Promise 封装接口3</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> request3 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          request(<span class="string">&#x27;https://www.taobao.com&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (response.retCode == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 这里的 response 是接口3的返回结果</span></span></span><br><span class="line"><span class="javascript">              resolve(<span class="string">&#x27;request3 success&#x27;</span> + response);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> promise;</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 先发起request1，等resolve后再发起request2；紧接着，等 request2有了 resolve之后，再发起 request3</span></span></span><br><span class="line">      request1()</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">res1</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 接口1请求成功后，打印接口1的返回结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(res1);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> request2();</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">res2</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 接口2请求成功后，打印接口2的返回结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(res2);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> request3();</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">res3</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 接口3请求成功后，打印接口3的返回结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(res3);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面代码中，then 是可以链式调用的，后面的 then 可以拿到前面 resolve 出来的数据。</p><p>这个举例很经典，需要多看几遍。</p><h2 id="return-的函数返回值"><a href="#return-的函数返回值" class="headerlink" title="return 的函数返回值"></a>return 的函数返回值</h2><p>return 后面的返回值，有两种情况：</p><ul><li><p>情况 1：返回 Promise 实例对象。返回的该实例对象会调用下一个 then。</p></li><li><p>情况 2：返回普通值。返回的普通值会直接传递给下一个 then，通过 then 参数中函数的参数接收该值。</p></li></ul><p>我们针对上面这两种情况，详细解释一下。</p><h3 id="情况-1：返回-Promise-实例对象"><a href="#情况-1：返回-Promise-实例对象" class="headerlink" title="情况 1：返回 Promise 实例对象"></a>情况 1：返回 Promise 实例对象</h3><p>举例如下：（这个例子，跟上一段 Ajax 链式调用 的例子差不多）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">      /*</span><br><span class="line"><span class="javascript">              基于<span class="built_in">Promise</span>发送Ajax请求</span></span><br><span class="line">            */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">          xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState != <span class="number">4</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理正常情况</span></span></span><br><span class="line">              resolve(xhr.responseText);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理异常情况</span></span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"><span class="javascript">          xhr.responseType = <span class="string">&#x27;json&#x27;</span>; <span class="comment">// 设置返回的数据类型</span></span></span><br><span class="line"><span class="javascript">          xhr.open(<span class="string">&#x27;get&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">          xhr.send(<span class="literal">null</span>); <span class="comment">// 请求接口</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="comment">// 发送多个ajax请求并且保证顺序</span></span></span><br><span class="line"><span class="javascript">      queryData(<span class="string">&#x27;http://localhost:3000/api1&#x27;</span>)</span></span><br><span class="line">        .then(</span><br><span class="line">          (data1) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data1));</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> queryData(<span class="string">&#x27;http://localhost:3000/api2&#x27;</span>);</span></span><br><span class="line">          &#125;,</span><br><span class="line">          (error1) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(error1);</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">        .then(</span><br><span class="line">          (data2) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data2));</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 这里的 return，返回的是 Promise 实例对象</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">              resolve(<span class="string">&#x27;qianguyihao&#x27;</span>);</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">          (error2) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(error2);</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data3);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="情况-2：返回-普通值"><a href="#情况-2：返回-普通值" class="headerlink" title="情况 2：返回 普通值"></a>情况 2：返回 普通值</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">      /*</span><br><span class="line"><span class="javascript">              基于<span class="built_in">Promise</span>发送Ajax请求</span></span><br><span class="line">            */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">          xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState != <span class="number">4</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理正常情况</span></span></span><br><span class="line">              resolve(xhr.responseText);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理异常情况</span></span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;接口请求失败&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"><span class="javascript">          xhr.responseType = <span class="string">&#x27;json&#x27;</span>; <span class="comment">// 设置返回的数据类型</span></span></span><br><span class="line"><span class="javascript">          xhr.open(<span class="string">&#x27;get&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">          xhr.send(<span class="literal">null</span>); <span class="comment">// 请求接口</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="comment">// 发送多个ajax请求并且保证顺序</span></span></span><br><span class="line"><span class="javascript">      queryData(<span class="string">&#x27;http://localhost:3000/api1&#x27;</span>)</span></span><br><span class="line">        .then(</span><br><span class="line">          (data1) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data1));</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> queryData(<span class="string">&#x27;http://localhost:3000/api2&#x27;</span>);</span></span><br><span class="line">          &#125;,</span><br><span class="line">          (error1) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(error1);</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">        .then(</span><br><span class="line">          (data2) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(data2));</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 返回普通值</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">&#x27;qianguyihao&#x27;</span>;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          (error2) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(error2);</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">        /*</span><br><span class="line">                    既然上方返回的是 普通值，那么，这里的 then 是谁来调用呢？</span><br><span class="line">                    答案是：这里会产生一个新的 默认的 promise实例，来调用这里的then，确保可以继续进行链式操作。</span><br><span class="line">                */</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">data3</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 这里的 data3 接收的是 普通值 &#x27;qianguyihao&#x27;</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data3);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Promise-的常用-API：实例方法【重要】"><a href="#Promise-的常用-API：实例方法【重要】" class="headerlink" title="Promise 的常用 API：实例方法【重要】"></a>Promise 的常用 API：实例方法【重要】</h2><p>Promise 自带的 API 提供了如下实例方法：</p><ul><li><p>promise.then()：获取异步任务的正常结果。</p></li><li><p>promise.catch()：获取异步任务的异常结果。</p></li><li><p>promise.finaly()：异步任务无论成功与否，都会执行。</p></li></ul><p>代码举例如下。</p><p>写法 1：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> data = &#123; <span class="attr">retCode</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;qianguyihao&#x27;</span> &#125;; <span class="comment">// 接口返回的数据</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (data.retCode == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 接口请求成功时调用</span></span></span><br><span class="line">              resolve(data);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 接口请求失败时调用</span></span></span><br><span class="line"><span class="javascript">              reject(&#123; <span class="attr">retCode</span>: -<span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;network error&#x27;</span> &#125;);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, 100);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      queryData()</span><br><span class="line"><span class="javascript">        .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 从 resolve 获取正常结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;接口请求成功时，走这里&#x27;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .catch(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 从 reject 获取异常结果</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;接口请求失败时，走这里&#x27;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(data);</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        .finally(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;无论接口请求成功与否，都会走这里&#x27;</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>写法 2：（和上面的写法 1 等价）</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> data = &#123; <span class="attr">retCode</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&#x27;qianguyihao&#x27;</span> &#125;; <span class="comment">// 接口返回的数据</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (data.retCode == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 接口请求成功时调用</span></span></span><br><span class="line">              resolve(data);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 接口请求失败时调用</span></span></span><br><span class="line"><span class="javascript">              reject(&#123; <span class="attr">retCode</span>: -<span class="number">1</span>, <span class="attr">msg</span>: <span class="string">&#x27;network error&#x27;</span> &#125;);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, 100);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      queryData()</span><br><span class="line">        .then(</span><br><span class="line">          (data) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// 从 resolve 获取正常结果</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;接口请求成功时，走这里&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data);</span></span><br><span class="line">          &#125;,</span><br><span class="line">          (data) =&gt; &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// 从 reject 获取异常结果</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;接口请求失败时，走这里&#x27;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data);</span></span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line"><span class="javascript">        .finally(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;无论接口请求成功与否，都会走这里&#x27;</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：写法 1 和写法 2 的作用是完全等价的。只不过，写法 2 是把 catch 里面的代码作为 then 里面的第二个参数而已。</p><h2 id="Promise-的常用-API：对象方法【重要】"><a href="#Promise-的常用-API：对象方法【重要】" class="headerlink" title="Promise 的常用 API：对象方法【重要】"></a>Promise 的常用 API：对象方法【重要】</h2><p>Promise 自带的 API 提供了如下对象方法：</p><ul><li><p>Promise.all()：并发处理多个异步任务，所有任务都执行成功，才能得到结果。</p></li><li><p>Promise.race(): 并发处理多个异步任务，只要有一个任务执行成功，就能得到结果。</p></li></ul><p>下面来详细介绍。</p><h3 id="Promise-all-代码举例"><a href="#Promise-all-代码举例" class="headerlink" title="Promise.all() 代码举例"></a>Promise.all() 代码举例</h3><p>代码举例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">      /*</span><br><span class="line"><span class="javascript">              封装 <span class="built_in">Promise</span> 接口调用</span></span><br><span class="line">            */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">          xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState != <span class="number">4</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理正常结果</span></span></span><br><span class="line">              resolve(xhr.responseText);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理异常结果</span></span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;服务器错误&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"><span class="javascript">          xhr.open(<span class="string">&#x27;get&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">          xhr.send(<span class="literal">null</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise1 = queryData(<span class="string">&#x27;http://localhost:3000/api1&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise2 = queryData(<span class="string">&#x27;http://localhost:3000/api2&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise3 = queryData(<span class="string">&#x27;http://localhost:3000/api3&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">Promise</span>.all([promise1, promise2, promise3]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(result);</span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Promise-race-代码举例"><a href="#Promise-race-代码举例" class="headerlink" title="Promise.race() 代码举例"></a>Promise.race() 代码举例</h3><p>代码举例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line">      /*</span><br><span class="line"><span class="javascript">              封装 <span class="built_in">Promise</span> 接口调用</span></span><br><span class="line">            */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">queryData</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">          xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState != <span class="number">4</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理正常结果</span></span></span><br><span class="line">              resolve(xhr.responseText);</span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 处理异常结果</span></span></span><br><span class="line"><span class="javascript">              reject(<span class="string">&#x27;服务器错误&#x27;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"><span class="javascript">          xhr.open(<span class="string">&#x27;get&#x27;</span>, url);</span></span><br><span class="line"><span class="javascript">          xhr.send(<span class="literal">null</span>);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise1 = queryData(<span class="string">&#x27;http://localhost:3000/api1&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise2 = queryData(<span class="string">&#x27;http://localhost:3000/api2&#x27;</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> promise3 = queryData(<span class="string">&#x27;http://localhost:3000/api3&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="built_in">Promise</span>.race([promise1, promise2, promise3]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(result);</span></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>了解这些内容之后， Promise 的基本用法，你就已经掌握了。</p><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> JS </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的博客开通啦</title>
      <link href="2021/01/02/Blogl%E5%BC%80%E5%A7%8B%E4%BA%86/"/>
      <url>2021/01/02/Blogl%E5%BC%80%E5%A7%8B%E4%BA%86/</url>
      
        <content type="html"><![CDATA[<p><strong>一直在电脑本地用Markdown记笔记,</strong><br><strong>突然觉得把笔记或是把自己的学习心得（主要是踩坑心得）放到博客中是一个不错的选择。</strong><br><strong>一来也可以监督自己，好好消化所学知识。</strong><br><strong>二来，要是这些心得能帮到需要的人就更好啦！</strong><br><strong>三来，记录一下自己的生活也不错呀~</strong><br><strong>不定时更新，欢迎扫码加微信交流呀</strong><br><img src= "https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImgloading2.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/luckyu2/imgLibrary/blogImg/addwechat.jpg"></p><head>  <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script></head><body>  <div id="waline"></div>  <script>    new Waline({      el: '#waline',      serverURL: 'https://comments-api.vercel.app',    });  </script></body><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css">]]></content>
      
      
      
        <tags>
            
            <tag> other </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
